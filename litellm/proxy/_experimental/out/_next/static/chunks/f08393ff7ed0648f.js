(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,289793,952840,617885,286718,23371,487147,498610,785952,193523,260573,e=>{"use strict";var t=e.i(764205),s=e.i(266027),a=e.i(243652),r=e.i(708347),l=e.i(135214);let i=(0,a.createQueryKeys)("agents");e.s(["useAgents",0,()=>{let{accessToken:e,userRole:a}=(0,l.default)();return(0,s.useQuery)({queryKey:i.list({}),queryFn:async()=>await (0,t.getAgentsList)(e),enabled:!!e&&r.all_admin_roles.includes(a||"")})}],289793);let n=(0,a.createQueryKeys)("customers");e.s(["useCustomers",0,()=>{let{accessToken:e,userRole:a}=(0,l.default)();return(0,s.useQuery)({queryKey:n.list({}),queryFn:async()=>await (0,t.allEndUsersCall)(e),enabled:!!e&&r.all_admin_roles.includes(a)})}],952840);var o=e.i(621482);let c=(0,a.createQueryKeys)("infiniteUsers"),d=50;e.s(["useInfiniteUsers",0,(e=d,s)=>{let{accessToken:a,userRole:i}=(0,l.default)();return(0,o.useInfiniteQuery)({queryKey:c.list({filters:{pageSize:e,...s&&{searchEmail:s}}}),queryFn:async({pageParam:r})=>await (0,t.userListCall)(a,null,r,e,s||null),initialPageParam:1,getNextPageParam:e=>{if(e.page<e.total_pages)return e.page+1},enabled:!!a&&r.all_admin_roles.includes(i)})}],617885);var u=e.i(843476),m=e.i(500330),x=e.i(980187),h=e.i(476961),p=e.i(584935),f=e.i(304967),g=e.i(350967),_=e.i(599724),j=e.i(629569),y=e.i(362024);let b={blue:"#3b82f6",cyan:"#06b6d4",indigo:"#6366f1",green:"#22c55e",red:"#ef4444",purple:"#8b5cf6",emerald:"#37bc7d"},k=({active:e,payload:t,label:s})=>e&&t&&t.length?(0,u.jsxs)("div",{className:"w-56 rounded-tremor-default border border-tremor-border bg-tremor-background p-2 text-tremor-default shadow-tremor-dropdown",children:[(0,u.jsx)("p",{className:"text-tremor-content-strong",children:s}),t.map(e=>{let t=e.dataKey?.toString();if(!t||!e.payload)return null;let s=((e,t)=>{let s=t.substring(t.indexOf(".")+1);if(e.metrics&&s in e.metrics)return e.metrics[s]})(e.payload,t),a=t.includes("spend"),r=void 0!==s?a?`$${s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`:s.toLocaleString():"N/A",l=b[e.color]||e.color;return(0,u.jsxs)("div",{className:"flex items-center justify-between space-x-4",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-2 ring-white drop-shadow-md",style:{backgroundColor:l}}),(0,u.jsx)("p",{className:"font-medium text-tremor-content dark:text-dark-tremor-content",children:t.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,u.jsx)("p",{className:"font-medium text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:r})]},t)})]}):null,v=({categories:e,colors:t})=>(0,u.jsx)("div",{className:"flex items-center justify-end space-x-4",children:e.map((e,s)=>{let a=b[t[s]]||t[s];return(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("span",{className:"h-2 w-2 shrink-0 rounded-full ring-4 ring-white",style:{backgroundColor:a}}),(0,u.jsx)("p",{className:"text-sm text-tremor-content dark:text-dark-tremor-content",children:e.replace("metrics.","").replace(/_/g," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]},e)})});e.s(["CustomLegend",0,v,"CustomTooltip",0,k],286718);var T=e.i(291542),N=e.i(271645);let C=[{title:"Model",dataIndex:"model",key:"model",render:e=>e||"-"},{title:"Spend (USD)",dataIndex:"spend",key:"spend",render:e=>`$${(0,m.formatNumberWithCommas)(e,2)}`},{title:"Successful",dataIndex:"successful_requests",key:"successful_requests",render:e=>(0,u.jsx)("span",{className:"text-green-600",children:e?.toLocaleString()||0})},{title:"Failed",dataIndex:"failed_requests",key:"failed_requests",render:e=>(0,u.jsx)("span",{className:"text-red-600",children:e?.toLocaleString()||0})},{title:"Tokens",dataIndex:"tokens",key:"tokens",render:e=>e?.toLocaleString()||0}],w=({topModels:e})=>{let[t,s]=(0,N.useState)("table");return 0===e.length?null:(0,u.jsxs)(f.Card,{className:"mt-4",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,u.jsx)(j.Title,{children:"Model Usage"}),(0,u.jsxs)("div",{className:"flex space-x-2",children:[(0,u.jsx)("button",{onClick:()=>s("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===t?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table"}),(0,u.jsx)("button",{onClick:()=>s("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===t?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart"})]})]}),"chart"===t?(0,u.jsx)("div",{className:"max-h-[234px] overflow-y-auto",children:(0,u.jsx)(p.BarChart,{style:{height:40*e.length},data:e.map(e=>({key:e.model,spend:e.spend})),index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,m.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:180,tickGap:5,showLegend:!1})}):(0,u.jsx)(T.Table,{columns:C,dataSource:e,rowKey:"model",size:"small",pagination:!1,scroll:e.length>5?{y:195}:void 0})]})};function q(e){return e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?e/1e3+"k":e.toString()}function S(e){return 0===e?"$0":e>=1e6?"$"+e/1e6+"M":e>=1e3?"$"+e/1e3+"k":"$"+e}e.s(["valueFormatter",()=>q,"valueFormatterSpend",()=>S],23371);let L=({modelName:e,metrics:t,hidePromptCachingMetrics:s=!1})=>(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsxs)(g.Grid,{numItems:4,className:"gap-4",children:[(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Requests"}),(0,u.jsx)(j.Title,{children:t.total_requests.toLocaleString()})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Successful Requests"}),(0,u.jsx)(j.Title,{children:t.total_successful_requests.toLocaleString()})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Tokens"}),(0,u.jsx)(j.Title,{children:t.total_tokens.toLocaleString()}),(0,u.jsxs)(_.Text,{children:[Math.round(t.total_tokens/t.total_successful_requests)," avg per successful request"]})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Spend"}),(0,u.jsxs)(j.Title,{children:["$",(0,m.formatNumberWithCommas)(t.total_spend,2)]}),(0,u.jsxs)(_.Text,{children:["$",(0,m.formatNumberWithCommas)(t.total_spend/t.total_successful_requests,3)," per successful request"]})]})]}),t.top_api_keys&&t.top_api_keys.length>0&&(0,u.jsxs)(f.Card,{className:"mt-4",children:[(0,u.jsx)(j.Title,{children:"Top Virtual Keys by Spend"}),(0,u.jsx)("div",{className:"mt-3",children:(0,u.jsx)("div",{className:"grid grid-cols-1 gap-2",children:t.top_api_keys.map((e,t)=>(0,u.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(_.Text,{className:"font-medium",children:e.key_alias||`${e.api_key.substring(0,10)}...`}),e.team_id&&(0,u.jsxs)(_.Text,{className:"text-xs text-gray-500",children:["Team: ",e.team_id]})]}),(0,u.jsxs)("div",{className:"text-right",children:[(0,u.jsxs)(_.Text,{className:"font-medium",children:["$",(0,m.formatNumberWithCommas)(e.spend,2)]}),(0,u.jsxs)(_.Text,{className:"text-xs text-gray-500",children:[e.requests.toLocaleString()," requests | ",e.tokens.toLocaleString()," tokens"]})]})]},e.api_key))})})]}),t.top_models&&t.top_models.length>0&&(0,u.jsx)(w,{topModels:t.top_models}),(0,u.jsxs)(f.Card,{className:"mt-4",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Spend per day"}),(0,u.jsx)(v,{categories:["metrics.spend"],colors:["green"]})]}),(0,u.jsx)(p.BarChart,{className:"mt-4",data:t.daily_data,index:"date",categories:["metrics.spend"],colors:["green"],valueFormatter:e=>`$${(0,m.formatNumberWithCommas)(e,2,!0)}`,yAxisWidth:72})]}),(0,u.jsxs)(g.Grid,{numItems:2,className:"gap-4 mt-4",children:[(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Total Tokens"}),(0,u.jsx)(v,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,u.jsx)(h.AreaChart,{className:"mt-4",data:t.daily_data,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:q,customTooltip:k,showLegend:!1})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Requests per day"}),(0,u.jsx)(v,{categories:["metrics.api_requests"],colors:["blue"]})]}),(0,u.jsx)(p.BarChart,{className:"mt-4",data:t.daily_data,index:"date",categories:["metrics.api_requests"],colors:["blue"],valueFormatter:q,customTooltip:k,showLegend:!1})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Success vs Failed Requests"}),(0,u.jsx)(v,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,u.jsx)(h.AreaChart,{className:"mt-4",data:t.daily_data,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:q,customTooltip:k,showLegend:!1})]}),!s&&(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Prompt Caching Metrics"}),(0,u.jsx)(v,{categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"]})]}),(0,u.jsxs)("div",{className:"mb-2",children:[(0,u.jsxs)(_.Text,{children:["Cache Read: ",t.total_cache_read_input_tokens?.toLocaleString()||0," tokens"]}),(0,u.jsxs)(_.Text,{children:["Cache Creation: ",t.total_cache_creation_input_tokens?.toLocaleString()||0," tokens"]})]}),(0,u.jsx)(h.AreaChart,{className:"mt-4",data:t.daily_data,index:"date",categories:["metrics.cache_read_input_tokens","metrics.cache_creation_input_tokens"],colors:["cyan","purple"],valueFormatter:q,customTooltip:k,showLegend:!1})]})]})]});e.s(["ActivityMetrics",0,({modelMetrics:e,hidePromptCachingMetrics:t=!1})=>{let s=Object.keys(e).sort((t,s)=>""===t?1:""===s?-1:e[s].total_spend-e[t].total_spend),a={total_requests:0,total_successful_requests:0,total_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,daily_data:{}};Object.values(e).forEach(e=>{a.total_requests+=e.total_requests,a.total_successful_requests+=e.total_successful_requests,a.total_tokens+=e.total_tokens,a.total_spend+=e.total_spend,a.total_cache_read_input_tokens+=e.total_cache_read_input_tokens||0,a.total_cache_creation_input_tokens+=e.total_cache_creation_input_tokens||0,e.daily_data.forEach(e=>{a.daily_data[e.date]||(a.daily_data[e.date]={prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,spend:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0}),a.daily_data[e.date].prompt_tokens+=e.metrics.prompt_tokens,a.daily_data[e.date].completion_tokens+=e.metrics.completion_tokens,a.daily_data[e.date].total_tokens+=e.metrics.total_tokens,a.daily_data[e.date].api_requests+=e.metrics.api_requests,a.daily_data[e.date].spend+=e.metrics.spend,a.daily_data[e.date].successful_requests+=e.metrics.successful_requests,a.daily_data[e.date].failed_requests+=e.metrics.failed_requests,a.daily_data[e.date].cache_read_input_tokens+=e.metrics.cache_read_input_tokens||0,a.daily_data[e.date].cache_creation_input_tokens+=e.metrics.cache_creation_input_tokens||0})});let r=Object.entries(a.daily_data).map(([e,t])=>({date:e,metrics:t})).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());return(0,u.jsxs)("div",{className:"space-y-8",children:[(0,u.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,u.jsx)(j.Title,{children:"Overall Usage"}),(0,u.jsxs)(g.Grid,{numItems:4,className:"gap-4 mb-4",children:[(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Requests"}),(0,u.jsx)(j.Title,{children:a.total_requests.toLocaleString()})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Successful Requests"}),(0,u.jsx)(j.Title,{children:a.total_successful_requests.toLocaleString()})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Tokens"}),(0,u.jsx)(j.Title,{children:a.total_tokens.toLocaleString()})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsx)(_.Text,{children:"Total Spend"}),(0,u.jsxs)(j.Title,{children:["$",(0,m.formatNumberWithCommas)(a.total_spend,2)]})]})]}),(0,u.jsxs)(g.Grid,{numItems:2,className:"gap-4",children:[(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Total Tokens Over Time"}),(0,u.jsx)(v,{categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"]})]}),(0,u.jsx)(h.AreaChart,{className:"mt-4",data:r,index:"date",categories:["metrics.prompt_tokens","metrics.completion_tokens","metrics.total_tokens"],colors:["blue","cyan","indigo"],valueFormatter:q,customTooltip:k,showLegend:!1})]}),(0,u.jsxs)(f.Card,{children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)(j.Title,{children:"Total Requests Over Time"}),(0,u.jsx)(v,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"]})]}),(0,u.jsx)(h.AreaChart,{className:"mt-4",data:r,index:"date",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["emerald","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:k,showLegend:!1})]})]})]}),(0,u.jsx)(y.Collapse,{defaultActiveKey:s[0],children:s.map(s=>(0,u.jsx)(y.Collapse.Panel,{header:(0,u.jsxs)("div",{className:"flex justify-between items-center w-full",children:[(0,u.jsx)(j.Title,{children:e[s].label||"Unknown Item"}),(0,u.jsxs)("div",{className:"flex space-x-4 text-sm text-gray-500",children:[(0,u.jsxs)("span",{children:["$",(0,m.formatNumberWithCommas)(e[s].total_spend,2)]}),(0,u.jsxs)("span",{children:[e[s].total_requests.toLocaleString()," requests"]})]})]}),children:(0,u.jsx)(L,{modelName:s||"Unknown Model",metrics:e[s],hidePromptCachingMetrics:t})},s))})]})},"processActivityData",0,(e,t,s=[])=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown[t]||{}).forEach(([r,l])=>{a[r]||(a[r]={label:"api_keys"===t?((e,t,s)=>{let a=e.metadata.key_alias||`key-hash-${t}`,r=e.metadata.team_id;if(r){let e=(0,x.resolveTeamAliasFromTeamID)(r,s);return e?`${a} (team: ${e})`:`${a} (team_id: ${r})`}return a})(l,r,s):r,total_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0,prompt_tokens:0,completion_tokens:0,total_spend:0,total_cache_read_input_tokens:0,total_cache_creation_input_tokens:0,top_api_keys:[],top_models:[],daily_data:[]}),a[r].total_requests+=l.metrics.api_requests,a[r].prompt_tokens+=l.metrics.prompt_tokens,a[r].completion_tokens+=l.metrics.completion_tokens,a[r].total_tokens+=l.metrics.total_tokens,a[r].total_spend+=l.metrics.spend,a[r].total_successful_requests+=l.metrics.successful_requests,a[r].total_failed_requests+=l.metrics.failed_requests,a[r].total_cache_read_input_tokens+=l.metrics.cache_read_input_tokens||0,a[r].total_cache_creation_input_tokens+=l.metrics.cache_creation_input_tokens||0,a[r].daily_data.push({date:e.date,metrics:{prompt_tokens:l.metrics.prompt_tokens,completion_tokens:l.metrics.completion_tokens,total_tokens:l.metrics.total_tokens,api_requests:l.metrics.api_requests,spend:l.metrics.spend,successful_requests:l.metrics.successful_requests,failed_requests:l.metrics.failed_requests,cache_read_input_tokens:l.metrics.cache_read_input_tokens||0,cache_creation_input_tokens:l.metrics.cache_creation_input_tokens||0}})})}),"api_keys"!==t&&Object.entries(a).forEach(([s,r])=>{let l={};e.results.forEach(e=>{let a=e.breakdown[t]?.[s];a&&"api_key_breakdown"in a&&Object.entries(a.api_key_breakdown||{}).forEach(([e,t])=>{l[e]||(l[e]={api_key:e,key_alias:t.metadata.key_alias,team_id:t.metadata.team_id,spend:0,requests:0,tokens:0}),l[e].spend+=t.metrics.spend,l[e].requests+=t.metrics.api_requests,l[e].tokens+=t.metrics.total_tokens})}),a[s].top_api_keys=Object.values(l).sort((e,t)=>t.spend-e.spend).slice(0,5)}),"api_keys"===t&&Object.entries(a).forEach(([t,s])=>{let r={};e.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{if(s&&"api_key_breakdown"in s){let a=s.api_key_breakdown?.[t];a&&(r[e]||(r[e]={model:e,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0}),r[e].spend+=a.metrics.spend,r[e].requests+=a.metrics.api_requests,r[e].successful_requests+=a.metrics.successful_requests||0,r[e].failed_requests+=a.metrics.failed_requests||0,r[e].tokens+=a.metrics.total_tokens)}})}),a[t].top_models=Object.values(r).sort((e,t)=>t.spend-e.spend)}),Object.values(a).forEach(e=>{e.daily_data.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())}),a}],487147);var D=e.i(994388),A=e.i(366283),E=e.i(779241),F=e.i(212931),O=e.i(808613),M=e.i(482725),$=e.i(199133),U=e.i(727749);e.s(["default",0,({isOpen:e,onClose:s,accessToken:a})=>{let[r]=O.Form.useForm(),[l,i]=(0,N.useState)(!1),[n,o]=(0,N.useState)(null),[c,d]=(0,N.useState)(!1),[m,x]=(0,N.useState)("cloudzero"),[h,p]=(0,N.useState)(!1);(0,N.useEffect)(()=>{e&&a&&f()},[e,a]);let f=async()=>{d(!0);try{let e=await fetch("/cloudzero/settings",{method:"GET",headers:{[(0,t.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"}});if(e.ok){let t=await e.json();o(t),r.setFieldsValue({connection_id:t.connection_id})}else if(404!==e.status){let t=await e.json();U.default.fromBackend(`Failed to load existing settings: ${t.error||"Unknown error"}`)}}catch(e){console.error("Error loading CloudZero settings:",e),U.default.fromBackend("Failed to load existing settings")}finally{d(!1)}},g=async e=>{if(!a)return void U.default.fromBackend("No access token available");i(!0);try{let s=n?"/cloudzero/settings":"/cloudzero/init",r=n?"PUT":"POST",l={...e,timezone:"UTC"},i=await fetch(s,{method:r,headers:{[(0,t.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify(l)}),c=await i.json();if(i.ok)return U.default.success(c.message||"CloudZero settings saved successfully"),o({api_key_masked:e.api_key.substring(0,4)+"****"+e.api_key.slice(-4),connection_id:e.connection_id,status:"configured"}),!0;return U.default.fromBackend(c.error||"Failed to save CloudZero settings"),!1}catch(e){return console.error("Error saving CloudZero settings:",e),U.default.fromBackend("Failed to save CloudZero settings"),!1}finally{i(!1)}},j=async()=>{if(!a)return void U.default.fromBackend("No access token available");p(!0);try{let e=await fetch("/cloudzero/export",{method:"POST",headers:{[(0,t.getGlobalLitellmHeaderName)()]:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({limit:1e5,operation:"replace_hourly"})}),r=await e.json();e.ok?(U.default.success(r.message||"Export to CloudZero completed successfully"),s()):U.default.fromBackend(r.error||"Failed to export to CloudZero")}catch(e){console.error("Error exporting to CloudZero:",e),U.default.fromBackend("Failed to export to CloudZero")}finally{p(!1)}},y=async()=>{p(!0);try{U.default.info("CSV export functionality coming soon!"),s()}catch(e){console.error("Error exporting CSV:",e),U.default.fromBackend("Failed to export CSV")}finally{p(!1)}},b=async()=>{if("cloudzero"===m){if(!n){let e=await r.validateFields();if(!await g(e))return}await j()}else await y()},k=()=>{r.resetFields(),x("cloudzero"),o(null),s()},v=[{value:"cloudzero",label:(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("img",{src:"/cloudzero.png",alt:"CloudZero",className:"w-5 h-5",onError:e=>{e.target.style.display="none"}}),(0,u.jsx)("span",{children:"Export to CloudZero"})]})},{value:"csv",label:(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,u.jsx)("span",{children:"Export to CSV"})]})}];return(0,u.jsx)(F.Modal,{title:"Export Data",open:e,onCancel:k,footer:null,width:600,destroyOnHidden:!0,children:(0,u.jsxs)("div",{className:"space-y-4",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)(_.Text,{className:"font-medium mb-2 block",children:"Export Destination"}),(0,u.jsx)($.Select,{value:m,onChange:x,options:v,className:"w-full",size:"large"})]}),"cloudzero"===m&&(0,u.jsx)("div",{children:c?(0,u.jsx)("div",{className:"flex justify-center py-8",children:(0,u.jsx)(M.Spin,{size:"large"})}):(0,u.jsxs)(u.Fragment,{children:[n&&(0,u.jsx)(A.Callout,{title:"Existing CloudZero Configuration",icon:()=>(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",className:"mb-4",children:(0,u.jsxs)(_.Text,{children:["API Key: ",n.api_key_masked,(0,u.jsx)("br",{}),"Connection ID: ",n.connection_id]})}),!n&&(0,u.jsxs)(O.Form,{form:r,layout:"vertical",children:[(0,u.jsx)(O.Form.Item,{label:"CloudZero API Key",name:"api_key",rules:[{required:!0,message:"Please enter your CloudZero API key"}],children:(0,u.jsx)(E.TextInput,{type:"password",placeholder:"Enter your CloudZero API key"})}),(0,u.jsx)(O.Form.Item,{label:"Connection ID",name:"connection_id",rules:[{required:!0,message:"Please enter the CloudZero connection ID"}],children:(0,u.jsx)(E.TextInput,{placeholder:"Enter CloudZero connection ID"})})]})]})}),"csv"===m&&(0,u.jsx)(A.Callout,{title:"CSV Export",icon:()=>(0,u.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),color:"blue",children:(0,u.jsx)(_.Text,{children:"Export your usage data as a CSV file for analysis in spreadsheet applications."})}),(0,u.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,u.jsx)(D.Button,{variant:"secondary",onClick:k,children:"Cancel"}),(0,u.jsx)(D.Button,{onClick:b,loading:l||h,disabled:l||h,children:"cloudzero"===m?"Export to CloudZero":"Export CSV"})]})]})})}],498610);var V=e.i(785242),R=e.i(464571),z=e.i(981339);let P=({value:e,onChange:t})=>(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Format"}),(0,u.jsx)($.Select,{value:e,onChange:t,className:"w-full",options:[{value:"csv",label:"CSV (Excel, Google Sheets)"},{value:"json",label:"JSON (includes metadata)"}]})]}),I=({dateRange:e,selectedFilters:t})=>(0,u.jsxs)("div",{className:"text-sm text-gray-500",children:[e.from?.toLocaleDateString()," - ",e.to?.toLocaleDateString(),t.length>0&&` \xb7 ${t.length} filter${t.length>1?"s":""}`]});var W=e.i(91739);let B=({value:e,onChange:t,entityType:s})=>(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"text-sm font-medium text-gray-700 block mb-2",children:"Export type"}),(0,u.jsx)(W.Radio.Group,{value:e,onChange:e=>t(e.target.value),className:"w-full",children:(0,u.jsxs)("div",{className:"space-y-2",children:[(0,u.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,u.jsx)(W.Radio,{value:"daily",className:"mt-0.5"}),(0,u.jsxs)("div",{className:"ml-3 flex-1",children:[(0,u.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",s]}),(0,u.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",s]})]})]}),(0,u.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,u.jsx)(W.Radio,{value:"daily_with_keys",className:"mt-0.5"}),(0,u.jsxs)("div",{className:"ml-3 flex-1",children:[(0,u.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day breakdown by ",s," and key"]}),(0,u.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Daily metrics for each ",s,", split by API key"]})]})]}),(0,u.jsxs)("label",{className:"flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,u.jsx)(W.Radio,{value:"daily_with_models",className:"mt-0.5"}),(0,u.jsxs)("div",{className:"ml-3 flex-1",children:[(0,u.jsxs)("div",{className:"font-medium text-sm",children:["Day-by-day by ",s," and model"]}),(0,u.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:"Daily metrics split by model"})]})]})]})})]});var Y=e.i(59935);let H=e=>{if(!e)return null;for(let t of Object.values(e)){let e=t?.metadata?.team_id;if(e)return e}return null},K=(e,t,s,a={})=>{switch(t){case"daily":default:return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([r,l])=>{let i=H(l.api_key_breakdown),n=i&&s[i]||null;a.push({Date:e.date,[t]:n||"-",[`${t} ID`]:i||"-","Spend ($)":(0,m.formatNumberWithCommas)(l.metrics.spend,4),Requests:l.metrics.api_requests,"Successful Requests":l.metrics.successful_requests,"Failed Requests":l.metrics.failed_requests,"Total Tokens":l.metrics.total_tokens,"Prompt Tokens":l.metrics.prompt_tokens||0,"Completion Tokens":l.metrics.completion_tokens||0})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_keys":return((e,t,s={})=>{let a={};return e.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([t,r])=>{Object.entries(r.api_key_breakdown||{}).forEach(([r,l])=>{let i=l?.metadata?.key_alias||null,n=l?.metadata?.team_id||t,o=n&&s[n]||null,c=`${e.date}_${n}_${r}`;a[c]?(a[c].metrics.spend+=l.metrics?.spend||0,a[c].metrics.api_requests+=l.metrics?.api_requests||0,a[c].metrics.successful_requests+=l.metrics?.successful_requests||0,a[c].metrics.failed_requests+=l.metrics?.failed_requests||0,a[c].metrics.total_tokens+=l.metrics?.total_tokens||0,a[c].metrics.prompt_tokens+=l.metrics?.prompt_tokens||0,a[c].metrics.completion_tokens+=l.metrics?.completion_tokens||0):a[c]={Date:e.date,teamId:n,teamAlias:o,keyId:r,keyAlias:i,metrics:{spend:l.metrics?.spend||0,api_requests:l.metrics?.api_requests||0,successful_requests:l.metrics?.successful_requests||0,failed_requests:l.metrics?.failed_requests||0,total_tokens:l.metrics?.total_tokens||0,prompt_tokens:l.metrics?.prompt_tokens||0,completion_tokens:l.metrics?.completion_tokens||0}}})})}),Object.values(a).map(e=>({Date:e.Date,[t]:e.teamAlias||"-",[`${t} ID`]:e.teamId||"-","Key Alias":e.keyAlias||"-","Key ID":e.keyId,"Spend ($)":(0,m.formatNumberWithCommas)(e.metrics.spend,4),Requests:e.metrics.api_requests,"Successful Requests":e.metrics.successful_requests,"Failed Requests":e.metrics.failed_requests,"Total Tokens":e.metrics.total_tokens,"Prompt Tokens":e.metrics.prompt_tokens,"Completion Tokens":e.metrics.completion_tokens})).sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a);case"daily_with_models":return((e,t,s={})=>{let a=[];return e.results.forEach(e=>{let r={};Object.entries(e.breakdown.entities||{}).forEach(([t,s])=>{r[t]||(r[t]={}),Object.entries(e.breakdown.models||{}).forEach(([e,a])=>{Object.entries(s.api_key_breakdown||{}).forEach(([s,a])=>{r[t][e]||(r[t][e]={spend:0,requests:0,successful:0,failed:0,tokens:0}),r[t][e].spend+=a.metrics.spend||0,r[t][e].requests+=a.metrics.api_requests||0,r[t][e].successful+=a.metrics.successful_requests||0,r[t][e].failed+=a.metrics.failed_requests||0,r[t][e].tokens+=a.metrics.total_tokens||0})})}),Object.entries(r).forEach(([r,l])=>{let i=e.breakdown.entities?.[r],n=H(i?.api_key_breakdown),o=n&&s[n]||null;Object.entries(l).forEach(([s,r])=>{a.push({Date:e.date,[t]:o||"-",[`${t} ID`]:n||"-",Model:s,"Spend ($)":(0,m.formatNumberWithCommas)(r.spend,4),Requests:r.requests,Successful:r.successful,Failed:r.failed,"Total Tokens":r.tokens})})})}),a.sort((e,t)=>new Date(e.Date).getTime()-new Date(t.Date).getTime())})(e,s,a)}},G=({isOpen:e,onClose:t,entityType:s,spendData:a,dateRange:r,selectedFilters:l,customTitle:i})=>{let[n,o]=(0,N.useState)("csv"),[c,d]=(0,N.useState)("daily"),[m,h]=(0,N.useState)(!1),{data:p,isLoading:f}=(0,V.useTeams)(),g=s.charAt(0).toUpperCase()+s.slice(1),_=i||`Export ${g} Usage`,j=(0,N.useMemo)(()=>(0,x.createTeamAliasMap)(p),[p]),y=async e=>{let i=e||n;h(!0);try{"csv"===i?(((e,t,s,a,r={})=>{let l=K(e,t,s,r),i=new Blob([Y.default.unparse(l)],{type:"text/csv;charset=utf-8;"}),n=window.URL.createObjectURL(i),o=document.createElement("a");o.href=n,o.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)})(a,c,g,s,j),U.default.success(`${g} usage data exported successfully as CSV`)):(((e,t,s,a,r,l,i={})=>{let n=K(e,t,s,i),o={export_date:new Date().toISOString(),entity_type:a,date_range:{from:r.from?.toISOString(),to:r.to?.toISOString()},filters_applied:l.length>0?l:"None",export_scope:t,summary:{total_spend:e.metadata.total_spend,total_requests:e.metadata.total_api_requests,successful_requests:e.metadata.total_successful_requests,failed_requests:e.metadata.total_failed_requests,total_tokens:e.metadata.total_tokens}},c=new Blob([JSON.stringify({metadata:o,data:n},null,2)],{type:"application/json"}),d=window.URL.createObjectURL(c),u=document.createElement("a");u.href=d,u.download=`${a}_usage_${t}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(d)})(a,c,g,s,r,l,j),U.default.success(`${g} usage data exported successfully as JSON`)),t()}catch(e){console.error("Error exporting data:",e),U.default.fromBackend("Failed to export data")}finally{h(!1)}};return(0,u.jsx)(F.Modal,{title:(0,u.jsx)("span",{className:"text-base font-semibold",children:_}),open:e,onCancel:t,footer:null,width:480,children:(0,u.jsxs)("div",{className:"space-y-5 py-2",children:[f?(0,u.jsx)(z.Skeleton,{active:!0}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(I,{dateRange:r,selectedFilters:l}),(0,u.jsx)(B,{value:c,onChange:d,entityType:s}),(0,u.jsx)(P,{value:n,onChange:o})]}),f?(0,u.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,u.jsx)(z.Skeleton.Button,{active:!0}),(0,u.jsx)(z.Skeleton.Button,{active:!0})]}):(0,u.jsxs)("div",{className:"flex items-center justify-end gap-2 pt-4 border-t",children:[(0,u.jsx)(R.Button,{variant:"outlined",onClick:t,disabled:m,children:"Cancel"}),(0,u.jsx)(R.Button,{onClick:()=>y(),loading:m||f,disabled:m||f,type:"primary",children:m?"Exporting...":`Export ${n.toUpperCase()}`})]})]})})};e.s(["default",0,G],785952),e.s(["default",0,({dateValue:e,entityType:t,spendData:s,showFilters:a=!1,filterLabel:r,filterPlaceholder:l,selectedFilters:i=[],onFiltersChange:n,filterOptions:o=[],customTitle:c,compactLayout:d=!1,teams:m=[]})=>{let[x,h]=(0,N.useState)(!1);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"mb-4",children:(0,u.jsxs)("div",{className:`grid ${a&&o.length>0?"grid-cols-[1fr_auto]":"grid-cols-[auto]"} items-end gap-4`,children:[a&&o.length>0&&(0,u.jsxs)("div",{children:[r&&(0,u.jsx)(_.Text,{className:"mb-2",children:r}),(0,u.jsx)($.Select,{mode:"multiple",style:{width:"100%"},placeholder:l,value:i,onChange:n,options:o,allowClear:!0})]}),(0,u.jsx)("div",{className:"justify-self-end",children:(0,u.jsx)(D.Button,{onClick:()=>h(!0),icon:()=>(0,u.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,u.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})})]})}),(0,u.jsx)(G,{isOpen:x,onClose:()=>h(!1),entityType:t,spendData:s,dateRange:e,selectedFilters:i,customTitle:c,teams:m})]})}],193523),e.s([],260573)},973706,e=>{"use strict";var t=e.i(843476);e.i(247167);var s=e.i(931067),a=e.i(271645);let r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V460h656v380zM184 392V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v136H184z"}}]},name:"calendar",theme:"outlined"};var l=e.i(9583),i=a.forwardRef(function(e,t){return a.createElement(l.default,(0,s.default)({},e,{ref:t,icon:r}))}),n=e.i(637235),o=e.i(994388),c=e.i(599724),d=e.i(166540);let u=[{label:"Today",shortLabel:"today",getValue:()=>({from:(0,d.default)().startOf("day").toDate(),to:(0,d.default)().endOf("day").toDate()})},{label:"Last 7 days",shortLabel:"7d",getValue:()=>({from:(0,d.default)().subtract(7,"days").startOf("day").toDate(),to:(0,d.default)().endOf("day").toDate()})},{label:"Last 30 days",shortLabel:"30d",getValue:()=>({from:(0,d.default)().subtract(30,"days").startOf("day").toDate(),to:(0,d.default)().endOf("day").toDate()})},{label:"Month to date",shortLabel:"MTD",getValue:()=>({from:(0,d.default)().startOf("month").toDate(),to:(0,d.default)().endOf("day").toDate()})},{label:"Year to date",shortLabel:"YTD",getValue:()=>({from:(0,d.default)().startOf("year").toDate(),to:(0,d.default)().endOf("day").toDate()})}];e.s(["default",0,({value:e,onValueChange:s,label:r="Select Time Range",showTimeRange:l=!0})=>{let[m,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(e),[f,g]=(0,a.useState)(null),[_,j]=(0,a.useState)(""),[y,b]=(0,a.useState)(""),k=(0,a.useRef)(null),v=(0,a.useCallback)(e=>{if(!e.from||!e.to)return null;for(let t of u){let s=t.getValue(),a=(0,d.default)(e.from).isSame((0,d.default)(s.from),"day"),r=(0,d.default)(e.to).isSame((0,d.default)(s.to),"day");if(a&&r)return t.shortLabel}return null},[]);(0,a.useEffect)(()=>{g(v(e))},[e,v]);let T=(0,a.useCallback)(()=>{if(!_||!y)return{isValid:!0,error:""};let e=(0,d.default)(_,"YYYY-MM-DD"),t=(0,d.default)(y,"YYYY-MM-DD");return e.isValid()&&t.isValid()?t.isBefore(e)?{isValid:!1,error:"End date cannot be before start date"}:{isValid:!0,error:""}:{isValid:!1,error:"Invalid date format"}},[_,y])();(0,a.useEffect)(()=>{e.from&&j((0,d.default)(e.from).format("YYYY-MM-DD")),e.to&&b((0,d.default)(e.to).format("YYYY-MM-DD")),p(e)},[e]),(0,a.useEffect)(()=>{let e=e=>{k.current&&!k.current.contains(e.target)&&x(!1)};return m&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[m]);let N=(0,a.useCallback)((e,t)=>{if(!e||!t)return"Select date range";let s=e=>(0,d.default)(e).format("D MMM, HH:mm");return`${s(e)} - ${s(t)}`},[]),C=(0,a.useCallback)(e=>{let t;if(!e.from)return e;let s={...e},a=new Date(e.from);return t=new Date(e.to?e.to:e.from),a.toDateString()===t.toDateString(),a.setHours(0,0,0,0),t.setHours(23,59,59,999),s.from=a,s.to=t,s},[]),w=(0,a.useCallback)(()=>{try{if(_&&y&&T.isValid){let e=(0,d.default)(_,"YYYY-MM-DD").startOf("day"),t=(0,d.default)(y,"YYYY-MM-DD").endOf("day");if(e.isValid()&&t.isValid()){let s={from:e.toDate(),to:t.toDate()};p(s);let a=v(s);g(a)}}}catch(e){console.warn("Invalid date format:",e)}},[_,y,T.isValid,v]);return(0,a.useEffect)(()=>{w()},[w]),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[r&&(0,t.jsx)(c.Text,{className:"text-sm font-medium text-gray-700 whitespace-nowrap",children:r}),(0,t.jsxs)("div",{className:"relative",ref:k,children:[(0,t.jsx)("div",{className:"w-[300px] px-3 py-2 text-sm border border-gray-300 rounded-md bg-white cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",onClick:()=>x(!m),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(n.ClockCircleOutlined,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-gray-900",children:N(e.from,e.to)})]}),(0,t.jsx)("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${m?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),m&&(0,t.jsx)("div",{className:"absolute top-full right-0 z-[9999] min-w-[600px] mt-1 bg-white border border-gray-200 rounded-lg shadow-xl",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsxs)("div",{className:"w-1/2 border-r border-gray-200",children:[(0,t.jsx)("div",{className:"p-3 border-b border-gray-200",children:(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Relative time"})}),(0,t.jsx)("div",{className:"h-[350px] overflow-y-auto",children:u.map(e=>{let s=f===e.shortLabel;return(0,t.jsxs)("div",{className:`flex items-center justify-between px-5 py-4 cursor-pointer border-b border-gray-100 transition-colors ${s?"bg-blue-50 hover:bg-blue-100 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>(e=>{let{from:t,to:s}=e.getValue();p({from:t,to:s}),g(e.shortLabel),j((0,d.default)(t).format("YYYY-MM-DD")),b((0,d.default)(s).format("YYYY-MM-DD"))})(e),children:[(0,t.jsx)("span",{className:`text-sm ${s?"text-blue-700 font-medium":"text-gray-700"}`,children:e.label}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded capitalize ${s?"text-blue-700 bg-blue-100":"text-gray-500 bg-gray-100"}`,children:e.shortLabel})]},e.label)})})]}),(0,t.jsxs)("div",{className:"w-1/2 relative",children:[(0,t.jsx)("div",{className:"p-3.5 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(i,{className:"text-gray-600"}),(0,t.jsx)("span",{className:"text-sm font-semibold text-gray-900",children:"Start and end dates"})]})}),(0,t.jsxs)("div",{className:"p-6 space-y-6 pb-20",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"Start date"}),(0,t.jsx)("input",{type:"date",value:_,onChange:e=>j(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!T.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm text-gray-700 mb-1 block",children:"End date"}),(0,t.jsx)("input",{type:"date",value:y,onChange:e=>b(e.target.value),className:`w-65 px-3 py-2 text-sm border rounded-md cursor-pointer hover:border-gray-400 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 ${!T.isValid?"border-red-300 focus:border-red-500 focus:ring-red-200":"border-gray-300"}`})]}),!T.isValid&&T.error&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,t.jsx)("span",{className:"text-sm text-red-700 font-medium",children:T.error})]})}),h.from&&h.to&&T.isValid&&(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-md space-y-1",children:[(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"From:"})," ",(0,d.default)(h.from).format("MMM D, YYYY [at] HH:mm:ss")]}),(0,t.jsxs)("div",{className:"text-xs text-blue-800",children:[(0,t.jsx)("span",{className:"font-medium",children:"To:"})," ",(0,d.default)(h.to).format("MMM D, YYYY [at] HH:mm:ss")]})]})]}),(0,t.jsx)("div",{className:"absolute bottom-4 right-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Button,{variant:"secondary",onClick:()=>{p(e),e.from&&j((0,d.default)(e.from).format("YYYY-MM-DD")),e.to&&b((0,d.default)(e.to).format("YYYY-MM-DD")),g(v(e)),x(!1)},children:"Cancel"}),(0,t.jsx)(o.Button,{onClick:()=>{h.from&&h.to&&T.isValid&&(s(h),requestIdleCallback(()=>{s(C(h))},{timeout:100}),x(!1))},disabled:!h.from||!h.to||!T.isValid,children:"Apply"})]})})]})]})})]})]})}],973706)},797305,e=>{"use strict";var t=e.i(843476),s=e.i(827252),a=e.i(56456),r=e.i(771674),l=e.i(584935),i=e.i(304967),n=e.i(309426),o=e.i(350967),c=e.i(197647),d=e.i(653824),u=e.i(881073),m=e.i(404206),x=e.i(723731),h=e.i(599724),p=e.i(629569),f=e.i(560445),g=e.i(560025),_=e.i(199133),j=e.i(592968),y=e.i(898586),b=e.i(152473),k=e.i(271645),v=e.i(289793),T=e.i(952840),N=e.i(135214),C=e.i(738014),w=e.i(617885),q=e.i(500330),S=e.i(994388),L=e.i(708347),D=e.i(487147),A=e.i(498610);e.i(260573);var E=e.i(785952),F=e.i(764205),O=e.i(973706),M=e.i(571303);let $=({isDateChanging:e=!1})=>(0,t.jsx)("div",{className:"flex items-center justify-center h-40",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,t.jsx)(M.UiLoadingSpinner,{className:"size-5"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-gray-600 text-sm font-medium",children:e?"Processing date selection...":"Loading chart data..."}),(0,t.jsx)("span",{className:"text-gray-400 text-xs mt-1",children:e?"This will only take a moment":"Fetching your data"})]})]})});var U=e.i(290571),V=e.i(95779),R=e.i(444755),z=e.i(673706);let P=k.default.forwardRef((e,t)=>{let{color:s,children:a,className:r}=e,l=(0,U.__rest)(e,["color","children","className"]);return k.default.createElement("p",Object.assign({ref:t,className:(0,R.tremorTwMerge)("font-semibold text-tremor-metric",s?(0,z.getColorClassNames)(s,V.colorPalette.darkText).textColor:"text-tremor-content-strong dark:text-dark-tremor-content-strong",r)},l),a)});P.displayName="Metric";var I=e.i(37091),W=e.i(269200),B=e.i(427612),Y=e.i(496020),H=e.i(64848),K=e.i(942232),G=e.i(977572);let Z=({accessToken:e,selectedTags:s,formatAbbreviatedNumber:a})=>{let r,i,n,o,[f,g]=(0,k.useState)({results:[],total_count:0,page:1,page_size:50,total_pages:0}),[_,j]=(0,k.useState)(!1),[y,b]=(0,k.useState)(1),v=async()=>{if(e){j(!0);try{let t=await (0,F.perUserAnalyticsCall)(e,y,50,s.length>0?s:void 0);g(t)}catch(e){console.error("Failed to fetch per-user data:",e)}finally{j(!1)}}};return(0,k.useEffect)(()=>{v()},[e,s,y]),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(p.Title,{children:"Per User Usage"}),(0,t.jsx)(I.Subtitle,{children:"Individual developer usage metrics"}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(u.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"User Details"}),(0,t.jsx)(c.Tab,{children:"Usage Distribution"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsxs)(W.Table,{children:[(0,t.jsx)(B.TableHead,{children:(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(H.TableHeaderCell,{children:"User ID"}),(0,t.jsx)(H.TableHeaderCell,{children:"User Email"}),(0,t.jsx)(H.TableHeaderCell,{children:"User Agent"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-right",children:"Success Generations"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-right",children:"Total Tokens"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-right",children:"Failed Requests"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-right",children:"Total Cost"})]})}),(0,t.jsx)(K.TableBody,{children:f.results.slice(0,10).map((e,s)=>(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(G.TableCell,{children:(0,t.jsx)(h.Text,{className:"font-medium",children:e.user_id})}),(0,t.jsx)(G.TableCell,{children:(0,t.jsx)(h.Text,{children:e.user_email||"N/A"})}),(0,t.jsx)(G.TableCell,{children:(0,t.jsx)(h.Text,{children:e.user_agent||"Unknown"})}),(0,t.jsx)(G.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.successful_requests)})}),(0,t.jsx)(G.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.total_tokens)})}),(0,t.jsx)(G.TableCell,{className:"text-right",children:(0,t.jsx)(h.Text,{children:a(e.failed_requests)})}),(0,t.jsx)(G.TableCell,{className:"text-right",children:(0,t.jsxs)(h.Text,{children:["$",a(e.spend,4)]})})]},s))})]}),f.results.length>10&&(0,t.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,t.jsxs)(h.Text,{className:"text-sm text-gray-500",children:["Showing 10 of ",f.total_count," results"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(S.Button,{size:"sm",variant:"secondary",onClick:()=>{y>1&&b(y-1)},disabled:1===y,children:"Previous"}),(0,t.jsx)(S.Button,{size:"sm",variant:"secondary",onClick:()=>{y<f.total_pages&&b(y+1)},disabled:y>=f.total_pages,children:"Next"})]})]})]}),(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)(p.Title,{className:"text-lg",children:"User Usage Distribution"}),(0,t.jsx)(I.Subtitle,{children:"Number of users by successful request frequency"})]}),(0,t.jsx)(l.BarChart,{data:(r=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";r.set(t,(r.get(t)||0)+1)}),i=Array.from(r.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e),n={"1-9 requests":{range:[1,9],agents:{}},"10-99 requests":{range:[10,99],agents:{}},"100-999 requests":{range:[100,999],agents:{}},"1K-9.9K requests":{range:[1e3,9999],agents:{}},"10K-99.9K requests":{range:[1e4,99999],agents:{}},"100K+ requests":{range:[1e5,1/0],agents:{}}},f.results.forEach(e=>{let t=e.successful_requests,s=e.user_agent||"Unknown";i.includes(s)&&Object.entries(n).forEach(([e,a])=>{t>=a.range[0]&&t<=a.range[1]&&(a.agents[s]||(a.agents[s]=0),a.agents[s]++)})}),Object.entries(n).map(([e,t])=>{let s={category:e};return i.forEach(e=>{s[e]=t.agents[e]||0}),s})),index:"category",categories:(o=new Map,f.results.forEach(e=>{let t=e.user_agent||"Unknown";o.set(t,(o.get(t)||0)+1)}),Array.from(o.entries()).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e)),colors:["blue","green","orange","red","purple","yellow","pink","indigo"],valueFormatter:e=>`${e} users`,yAxisWidth:80,showLegend:!0,stack:!0})]})]})]})]})},J=({accessToken:e,userRole:s,dateValue:a,onDateChange:r})=>{let[n,f]=(0,k.useState)({results:[]}),[g,y]=(0,k.useState)({results:[]}),[b,v]=(0,k.useState)({results:[]}),[T,N]=(0,k.useState)({results:[]}),[C,w]=(0,k.useState)(""),[q,S]=(0,k.useState)([]),[L,D]=(0,k.useState)([]),[A,E]=(0,k.useState)(!1),[O,M]=(0,k.useState)(!1),[U,V]=(0,k.useState)(!1),[R,z]=(0,k.useState)(!1),[W,B]=(0,k.useState)(!1),Y=new Date,H=async()=>{if(e){E(!0);try{let t=await (0,F.tagDistinctCall)(e);S(t.results.map(e=>e.tag))}catch(e){console.error("Failed to fetch available tags:",e)}finally{E(!1)}}},K=async()=>{if(e){M(!0);try{let t=await (0,F.tagDauCall)(e,Y,C||void 0,L.length>0?L:void 0);f(t)}catch(e){console.error("Failed to fetch DAU data:",e)}finally{M(!1)}}},G=async()=>{if(e){V(!0);try{let t=await (0,F.tagWauCall)(e,Y,C||void 0,L.length>0?L:void 0);y(t)}catch(e){console.error("Failed to fetch WAU data:",e)}finally{V(!1)}}},J=async()=>{if(e){z(!0);try{let t=await (0,F.tagMauCall)(e,Y,C||void 0,L.length>0?L:void 0);v(t)}catch(e){console.error("Failed to fetch MAU data:",e)}finally{z(!1)}}},Q=async()=>{if(e&&a.from&&a.to){B(!0);try{let t=await (0,F.userAgentSummaryCall)(e,a.from,a.to,L.length>0?L:void 0);N(t)}catch(e){console.error("Failed to fetch user agent summary data:",e)}finally{B(!1)}}};(0,k.useEffect)(()=>{H()},[e]),(0,k.useEffect)(()=>{if(!e)return;let t=setTimeout(()=>{K(),G(),J()},50);return()=>clearTimeout(t)},[e,C,L]),(0,k.useEffect)(()=>{if(!a.from||!a.to)return;let e=setTimeout(()=>{Q()},50);return()=>clearTimeout(e)},[e,a,L]);let X=e=>e.startsWith("User-Agent: ")?e.replace("User-Agent: ",""):e,ee=e=>Object.entries(e.reduce((e,t)=>(e[t.tag]=(e[t.tag]||0)+t.active_users,e),{})).sort(([,e],[,t])=>t-e).map(([e])=>e),et=ee(n.results).slice(0,10),es=ee(g.results).slice(0,10),ea=ee(b.results).slice(0,10),er=(()=>{let e=[],t=new Date;for(let s=6;s>=0;s--){let a=new Date(t);a.setDate(a.getDate()-s);let r={date:a.toISOString().split("T")[0]};et.forEach(e=>{r[X(e)]=0}),e.push(r)}return n.results.forEach(t=>{let s=X(t.tag),a=e.find(e=>e.date===t.date);a&&(a[s]=t.active_users)}),e})(),el=(()=>{let e=[];for(let t=1;t<=7;t++){let s={week:`Week ${t}`};es.forEach(e=>{s[X(e)]=0}),e.push(s)}return g.results.forEach(t=>{let s=X(t.tag),a=t.date.match(/Week (\d+)/);if(a){let r=`Week ${a[1]}`,l=e.find(e=>e.week===r);l&&(l[s]=t.active_users)}}),e})(),ei=(()=>{let e=[];for(let t=1;t<=7;t++){let s={month:`Month ${t}`};ea.forEach(e=>{s[X(e)]=0}),e.push(s)}return b.results.forEach(t=>{let s=X(t.tag),a=t.date.match(/Month (\d+)/);if(a){let r=`Month ${a[1]}`,l=e.find(e=>e.month===r);l&&(l[s]=t.active_users)}}),e})(),en=(e,t=0)=>{if(e>=1e8||e>=1e7)return(e/1e6).toFixed(t)+"M";if(e>=1e6)return(e/1e6).toFixed(t)+"M";if(e>=1e4)return(e/1e3).toFixed(t)+"K";if(e>=1e3)return(e/1e3).toFixed(t)+"K";else return e.toFixed(t)};return(0,t.jsxs)("div",{className:"space-y-6 mt-6",children:[(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Title,{children:"Summary by User Agent"}),(0,t.jsx)(I.Subtitle,{children:"Performance metrics for different user agents"})]}),(0,t.jsxs)("div",{className:"w-96",children:[(0,t.jsx)(h.Text,{className:"text-sm font-medium block mb-2",children:"Filter by User Agents"}),(0,t.jsx)(_.Select,{mode:"multiple",placeholder:"All User Agents",value:L,onChange:D,style:{width:"100%"},showSearch:!0,allowClear:!0,loading:A,optionFilterProp:"label",className:"rounded-md",maxTagCount:"responsive",children:q.map(e=>{let s=X(e),a=s.length>50?`${s.substring(0,50)}...`:s;return(0,t.jsx)(_.Select.Option,{value:e,label:a,title:s,children:a},e)})})]})]}),W?(0,t.jsx)($,{isDateChanging:!1}):(0,t.jsxs)(o.Grid,{numItems:4,className:"gap-4",children:[(T.results||[]).slice(0,4).map((e,s)=>{let a=X(e.tag),r=a.length>15?a.substring(0,15)+"...":a;return(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(j.Tooltip,{title:a,placement:"top",children:(0,t.jsx)(p.Title,{className:"truncate",children:r})}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(P,{className:"text-lg",children:en(e.successful_requests)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(P,{className:"text-lg",children:en(e.total_tokens)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsxs)(P,{className:"text-lg",children:["$",en(e.total_spend,4)]})]})]})]},s)}),Array.from({length:Math.max(0,4-(T.results||[]).length)}).map((e,s)=>(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"No Data"}),(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Success Requests"}),(0,t.jsx)(P,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Tokens"}),(0,t.jsx)(P,{className:"text-lg",children:"-"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(h.Text,{className:"text-sm text-gray-600",children:"Total Cost"}),(0,t.jsx)(P,{className:"text-lg",children:"-"})]})]})]},`empty-${s}`))]})]})}),(0,t.jsx)(i.Card,{children:(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(u.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"DAU/WAU/MAU"}),(0,t.jsx)(c.Tab,{children:"Per User Usage (Last 30 Days)"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(p.Title,{children:"DAU, WAU & MAU per Agent"}),(0,t.jsx)(I.Subtitle,{children:"Active users across different time periods"})]}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(u.TabList,{className:"mb-6",children:[(0,t.jsx)(c.Tab,{children:"DAU"}),(0,t.jsx)(c.Tab,{children:"WAU"}),(0,t.jsx)(c.Tab,{children:"MAU"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Daily Active Users - Last 7 Days"})}),O?(0,t.jsx)($,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:er,index:"date",categories:et.map(X),valueFormatter:e=>en(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Weekly Active Users - Last 7 Weeks"})}),U?(0,t.jsx)($,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:el,index:"week",categories:es.map(X),valueFormatter:e=>en(e),yAxisWidth:60,showLegend:!0,stack:!0})]}),(0,t.jsxs)(m.TabPanel,{children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(p.Title,{className:"text-lg",children:"Monthly Active Users - Last 7 Months"})}),R?(0,t.jsx)($,{isDateChanging:!1}):(0,t.jsx)(l.BarChart,{data:ei,index:"month",categories:ea.map(X),valueFormatter:e=>en(e),yAxisWidth:60,showLegend:!0,stack:!0})]})]})]})]}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(Z,{accessToken:e,selectedTags:L,formatAbbreviatedNumber:en})})]})]})})]})};var Q=e.i(617802),X=e.i(23371),ee=e.i(286718);let et=({endpointData:e})=>{let s=e||{},a=k.default.useMemo(()=>Object.entries(s).map(([e,t])=>({endpoint:e,"metrics.successful_requests":t.metrics.successful_requests,"metrics.failed_requests":t.metrics.failed_requests,metrics:{successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests}})),[s]);return(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(p.Title,{children:"Success vs Failed Requests by Endpoint"}),(0,t.jsx)(ee.CustomLegend,{categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"]})]}),(0,t.jsx)(l.BarChart,{className:"mt-4",data:a,index:"endpoint",categories:["metrics.successful_requests","metrics.failed_requests"],colors:["green","red"],valueFormatter:e=>e.toLocaleString(),customTooltip:ee.CustomTooltip,showLegend:!1,stack:!0,yAxisWidth:60})]})};var es=e.i(731195),ea=e.i(883966),er=e.i(555706),el=e.i(785183),ei=e.i(93230),en=e.i(844171),eo=(0,ea.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:er.Line,axisComponents:[{axisType:"xAxis",AxisComp:el.XAxis},{axisType:"yAxis",AxisComp:ei.YAxis}],formatAxisMap:en.formatAxisMap}),ec=e.i(872526),ed=e.i(800494),eu=e.i(234239),em=e.i(559559),ex=e.i(238279),eh=e.i(114887),ep=e.i(933303),ef=e.i(628781),eg=e.i(472007),e_=e.i(480731);let ej=k.default.forwardRef((e,t)=>{let{data:s=[],categories:a=[],index:r,colors:l=V.themeColorRange,valueFormatter:i=z.defaultValueFormatter,startEndOnly:n=!1,showXAxis:o=!0,showYAxis:c=!0,yAxisWidth:d=56,intervalType:u="equidistantPreserveStart",animationDuration:m=900,showAnimation:x=!1,showTooltip:h=!0,showLegend:p=!0,showGridLines:f=!0,autoMinValue:g=!1,curveType:_="linear",minValue:j,maxValue:y,connectNulls:b=!1,allowDecimals:v=!0,noDataText:T,className:N,onValueChange:C,enableLegendSlider:w=!1,customTooltip:q,rotateLabelX:S,padding:L=o||c?{left:20,right:20}:{left:0,right:0},tickGap:D=5,xAxisLabel:A,yAxisLabel:E}=e,F=(0,U.__rest)(e,["data","categories","index","colors","valueFormatter","startEndOnly","showXAxis","showYAxis","yAxisWidth","intervalType","animationDuration","showAnimation","showTooltip","showLegend","showGridLines","autoMinValue","curveType","minValue","maxValue","connectNulls","allowDecimals","noDataText","className","onValueChange","enableLegendSlider","customTooltip","rotateLabelX","padding","tickGap","xAxisLabel","yAxisLabel"]),[O,M]=(0,k.useState)(60),[$,P]=(0,k.useState)(void 0),[I,W]=(0,k.useState)(void 0),B=(0,eg.constructCategoryColors)(a,l),Y=(0,eg.getYAxisDomain)(g,j,y),H=!!C;function K(e){H&&(e===I&&!$||(0,eg.hasOnlyOneValueForThisKey)(s,e)&&$&&$.dataKey===e?(W(void 0),null==C||C(null)):(W(e),null==C||C({eventType:"category",categoryClicked:e})),P(void 0))}return k.default.createElement("div",Object.assign({ref:t,className:(0,R.tremorTwMerge)("w-full h-80",N)},F),k.default.createElement(es.ResponsiveContainer,{className:"h-full w-full"},(null==s?void 0:s.length)?k.default.createElement(eo,{data:s,onClick:H&&(I||$)?()=>{P(void 0),W(void 0),null==C||C(null)}:void 0,margin:{bottom:A?30:void 0,left:E?20:void 0,right:E?5:void 0,top:5}},f?k.default.createElement(ec.CartesianGrid,{className:(0,R.tremorTwMerge)("stroke-1","stroke-tremor-border","dark:stroke-dark-tremor-border"),horizontal:!0,vertical:!1}):null,k.default.createElement(el.XAxis,{padding:L,hide:!o,dataKey:r,interval:n?"preserveStartEnd":u,tick:{transform:"translate(0, 6)"},ticks:n?[s[0][r],s[s.length-1][r]]:void 0,fill:"",stroke:"",className:(0,R.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickLine:!1,axisLine:!1,minTickGap:D,angle:null==S?void 0:S.angle,dy:null==S?void 0:S.verticalShift,height:null==S?void 0:S.xAxisHeight},A&&k.default.createElement(ed.Label,{position:"insideBottom",offset:-20,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},A)),k.default.createElement(ei.YAxis,{width:d,hide:!c,axisLine:!1,tickLine:!1,type:"number",domain:Y,tick:{transform:"translate(-3, 0)"},fill:"",stroke:"",className:(0,R.tremorTwMerge)("text-tremor-label","fill-tremor-content","dark:fill-dark-tremor-content"),tickFormatter:i,allowDecimals:v},E&&k.default.createElement(ed.Label,{position:"insideLeft",style:{textAnchor:"middle"},angle:-90,offset:-15,className:"fill-tremor-content-emphasis text-tremor-default font-medium dark:fill-dark-tremor-content-emphasis"},E)),k.default.createElement(eu.Tooltip,{wrapperStyle:{outline:"none"},isAnimationActive:!1,cursor:{stroke:"#d1d5db",strokeWidth:1},content:h?({active:e,payload:t,label:s})=>q?k.default.createElement(q,{payload:null==t?void 0:t.map(e=>{var t;return Object.assign(Object.assign({},e),{color:null!=(t=B.get(e.dataKey))?t:e_.BaseColors.Gray})}),active:e,label:s}):k.default.createElement(ep.default,{active:e,payload:t,label:s,valueFormatter:i,categoryColors:B}):k.default.createElement(k.default.Fragment,null),position:{y:0}}),p?k.default.createElement(em.Legend,{verticalAlign:"top",height:O,content:({payload:e})=>(0,eh.default)({payload:e},B,M,I,H?e=>K(e):void 0,w)}):null,a.map(e=>{var t;return k.default.createElement(er.Line,{className:(0,R.tremorTwMerge)((0,z.getColorClassNames)(null!=(t=B.get(e))?t:e_.BaseColors.Gray,V.colorPalette.text).strokeColor),strokeOpacity:$||I&&I!==e?.3:1,activeDot:e=>{var t;let{cx:a,cy:r,stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,dataKey:c}=e;return k.default.createElement(ex.Dot,{className:(0,R.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,z.getColorClassNames)(null!=(t=B.get(c))?t:e_.BaseColors.Gray,V.colorPalette.text).fillColor),cx:a,cy:r,r:5,fill:"",stroke:l,strokeLinecap:i,strokeLinejoin:n,strokeWidth:o,onClick:(t,a)=>{a.stopPropagation(),H&&(e.index===(null==$?void 0:$.index)&&e.dataKey===(null==$?void 0:$.dataKey)||(0,eg.hasOnlyOneValueForThisKey)(s,e.dataKey)&&I&&I===e.dataKey?(W(void 0),P(void 0),null==C||C(null)):(W(e.dataKey),P({index:e.index,dataKey:e.dataKey}),null==C||C(Object.assign({eventType:"dot",categoryClicked:e.dataKey},e.payload))))}})},dot:t=>{var a;let{stroke:r,strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,cx:o,cy:c,dataKey:d,index:u}=t;return(0,eg.hasOnlyOneValueForThisKey)(s,e)&&!($||I&&I!==e)||(null==$?void 0:$.index)===u&&(null==$?void 0:$.dataKey)===e?k.default.createElement(ex.Dot,{key:u,cx:o,cy:c,r:5,stroke:r,fill:"",strokeLinecap:l,strokeLinejoin:i,strokeWidth:n,className:(0,R.tremorTwMerge)("stroke-tremor-background dark:stroke-dark-tremor-background",C?"cursor-pointer":"",(0,z.getColorClassNames)(null!=(a=B.get(d))?a:e_.BaseColors.Gray,V.colorPalette.text).fillColor)}):k.default.createElement(k.Fragment,{key:u})},key:e,name:e,type:_,dataKey:e,stroke:"",strokeWidth:2,strokeLinejoin:"round",strokeLinecap:"round",isAnimationActive:x,animationDuration:m,connectNulls:b})}),C?a.map(e=>k.default.createElement(er.Line,{className:(0,R.tremorTwMerge)("cursor-pointer"),strokeOpacity:0,key:e,name:e,type:_,dataKey:e,stroke:"transparent",fill:"transparent",legendType:"none",tooltipType:"none",strokeWidth:12,connectNulls:b,onClick:(e,t)=>{t.stopPropagation();let{name:s}=e;K(s)}})):null):k.default.createElement(ef.default,{noDataText:T})))});ej.displayName="LineChart";let ey=function({dailyData:e,endpointData:s}){let a=(0,k.useMemo)(()=>{var t;let s,a;return e?.results&&0!==e.results.length?(t=e.results,s=[],a=new Set,t.forEach(e=>{e.breakdown.endpoints&&Object.keys(e.breakdown.endpoints).forEach(e=>a.add(e))}),t.forEach(e=>{let t={date:new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})};a.forEach(s=>{let a=e.breakdown.endpoints?.[s];t[s]=a?.metrics.api_requests||0}),s.push(t)}),s.reverse()):[]},[e]),r=(0,k.useMemo)(()=>0===a.length?[]:Object.keys(a[0]).filter(e=>"date"!==e),[a]);return(0,t.jsxs)(i.Card,{className:"mb-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,t.jsx)(p.Title,{children:"Endpoint Usage Trends"})}),(0,t.jsx)(ej,{className:"h-80",data:a,index:"date",categories:r,colors:["blue","cyan","indigo","violet","purple","fuchsia","pink","rose","red","orange"].slice(0,r.length),valueFormatter:e=>e.toLocaleString(),showLegend:!0,showGridLines:!0,yAxisWidth:60,connectNulls:!0,curveType:"natural"})]})};var eb=e.i(291542),ek=e.i(309821),ek=ek;let ev=({endpointData:e})=>{let s=Object.entries(e).map(([e,t])=>{var s,a;return{key:e,endpoint:e,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,api_requests:t.metrics.api_requests,total_tokens:t.metrics.total_tokens,spend:t.metrics.spend,successRate:(s=t.metrics.successful_requests,0===(a=t.metrics.api_requests)?0:s/a*100)}}),a=[{title:"Endpoint",dataIndex:"endpoint",key:"endpoint",render:e=>(0,t.jsx)("span",{className:"font-medium",children:e})},{title:"Successful / Failed",key:"requests",render:(e,s)=>{let a=s.api_requests>0?s.successful_requests/s.api_requests*100:0,r=s.api_requests>0?s.failed_requests/s.api_requests*100:0,l={"0%":"#22c55e"};return a>0&&a<100&&(l[`${a}%`]="#22c55e",l[`${a+.01}%`]="#ef4444"),l["100%"]=r>0?"#ef4444":"#22c55e",(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)(ek.default,{percent:a+r,size:"small",strokeColor:l,showInfo:!1})}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 text-sm min-w-[100px]",children:[(0,t.jsx)("span",{className:"text-green-600 font-medium",children:s.successful_requests.toLocaleString()}),(0,t.jsx)("span",{className:"text-gray-400",children:"/"}),(0,t.jsx)("span",{className:"text-red-600 font-medium",children:s.failed_requests.toLocaleString()})]})]})}},{title:"Total Request",dataIndex:"api_requests",key:"api_requests",render:e=>e.toLocaleString()},{title:"Success Rate",dataIndex:"successRate",key:"successRate",render:e=>{let s=e.toFixed(2);return(0,t.jsxs)("span",{className:e>=95?"text-green-600 font-medium":e>=80?"text-yellow-600 font-medium":"text-red-600 font-medium",children:[s,"%"]})}},{title:"Total Tokens",dataIndex:"total_tokens",key:"total_tokens",render:e=>e.toLocaleString()},{title:"Spend",dataIndex:"spend",key:"spend",render:e=>`$${(0,q.formatNumberWithCommas)(e,2)}`}];return(0,t.jsx)(eb.Table,{columns:a,dataSource:s,pagination:!1})},eT=({userSpendData:e})=>{let s=(0,k.useMemo)(()=>{let t={};return e?.results&&e.results.forEach(e=>{Object.entries(e.breakdown.endpoints||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:s.metadata||{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),t},[e]);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(ev,{endpointData:s}),(0,t.jsx)(et,{endpointData:s}),(0,t.jsx)(ey,{dailyData:e,endpointData:s})]})};var eN=e.i(214541),eC=e.i(413990),ew=e.i(193523),ew=ew,eq=e.i(916925),eS=e.i(1023),eL=e.i(149121);function eD({topModels:e,topModelsLimit:s,setTopModelsLimit:a}){let[r,i]=(0,k.useState)("table"),n=[{header:"Model",accessorKey:"key",cell:e=>e.getValue()||"-"},{header:"Spend (USD)",accessorKey:"spend",cell:e=>{let t=e.getValue();return`$${(0,q.formatNumberWithCommas)(t,2)}`}},{header:"Successful",accessorKey:"successful_requests",cell:e=>(0,t.jsx)("span",{className:"text-green-600",children:e.getValue()?.toLocaleString()||0})},{header:"Failed",accessorKey:"failed_requests",cell:e=>(0,t.jsx)("span",{className:"text-red-600",children:e.getValue()?.toLocaleString()||0})},{header:"Tokens",accessorKey:"tokens",cell:e=>e.getValue()?.toLocaleString()||0}],o=e.slice(0,s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,t.jsx)(g.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:s,onChange:e=>a(e)}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:()=>i("table"),className:`px-3 py-1 text-sm rounded-md ${"table"===r?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Table View"}),(0,t.jsx)("button",{onClick:()=>i("chart"),className:`px-3 py-1 text-sm rounded-md ${"chart"===r?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"}`,children:"Chart View"})]})]}),"chart"===r?(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(0,t.jsx)(l.BarChart,{className:"mt-4 cursor-pointer hover:opacity-90",style:{height:52*Math.min(o.length,s)},data:o,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:e=>`$${(0,q.formatNumberWithCommas)(e,2)}`,layout:"vertical",yAxisWidth:200,tickGap:5,showLegend:!1})}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden max-h-[600px] overflow-y-auto",children:(0,t.jsx)(eL.DataTable,{columns:n,data:o,renderSubComponent:()=>(0,t.jsx)(t.Fragment,{}),getRowCanExpand:()=>!1,isLoading:!1})})]})}let eA=({accessToken:e,entityType:s,entityId:a,entityList:r,dateValue:f})=>{let g,_,[j,y]=(0,k.useState)({results:[],metadata:{total_spend:0,total_api_requests:0,total_successful_requests:0,total_failed_requests:0,total_tokens:0}}),{teams:b}=(0,eN.default)(),v=(0,D.processActivityData)(j,"models",b||[]),T=(0,D.processActivityData)(j,"api_keys",b||[]),[N,C]=(0,k.useState)([]),[w,S]=(0,k.useState)(5),[L,A]=(0,k.useState)(5),E=async()=>{if(!e||!f.from||!f.to)return;let t=new Date(f.from),a=new Date(f.to);if("tag"===s)y(await (0,F.tagDailyActivityCall)(e,t,a,1,N.length>0?N:null));else if("team"===s)y(await (0,F.teamDailyActivityCall)(e,t,a,1,N.length>0?N:null));else if("organization"===s)y(await (0,F.organizationDailyActivityCall)(e,t,a,1,N.length>0?N:null));else if("customer"===s)y(await (0,F.customerDailyActivityCall)(e,t,a,1,N.length>0?N:null));else if("agent"===s)y(await (0,F.agentDailyActivityCall)(e,t,a,1,N.length>0?N:null));else throw Error("Invalid entity type")};(0,k.useEffect)(()=>{E()},[e,f,a,N]);let O=()=>{let e={};return j.results.forEach(t=>{Object.entries(t.breakdown.providers||{}).forEach(([t,s])=>{e[t]||(e[t]={provider:t,spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{e[t].spend+=s.metrics.spend,e[t].requests+=s.metrics.api_requests,e[t].successful_requests+=s.metrics.successful_requests,e[t].failed_requests+=s.metrics.failed_requests,e[t].tokens+=s.metrics.total_tokens}catch(e){console.error(`Error processing provider ${t}: ${e}`)}})}),Object.values(e).filter(e=>e.spend>0).sort((e,t)=>t.spend-e.spend)},M=(e,t)=>{if(r){let t=r.find(t=>t.value===e);if(t)return t.label}return t?.team_alias?t.team_alias:e},$=()=>{var e;let t={};return j.results.forEach(e=>{Object.entries(e.breakdown.entities||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{alias:M(e,s.metadata),id:e}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.total_tokens+=s.metrics.total_tokens})}),e=Object.values(t).sort((e,t)=>t.metrics.spend-e.metrics.spend),0===N.length?e:e.filter(e=>N.includes(e.metadata.id))},U=s.charAt(0).toUpperCase()+s.slice(1);return(0,t.jsxs)("div",{style:{width:"100%"},className:"relative",children:[(0,t.jsx)(ew.default,{dateValue:f,entityType:s,spendData:j,showFilters:null!==r&&r.length>0,filterLabel:`Filter by ${s}`,filterPlaceholder:`Select ${s} to filter...`,selectedFilters:N,onFiltersChange:C,filterOptions:(()=>{if(r)return r})()||void 0,teams:b||[]}),(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)(u.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(c.Tab,{children:"Cost"}),(0,t.jsx)(c.Tab,{children:"agent"===s?"Request / Token Consumption":"Model Activity"}),(0,t.jsx)(c.Tab,{children:"Key Activity"}),(0,t.jsx)(c.Tab,{children:"Endpoint Activity"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsx)(m.TabPanel,{children:(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(p.Title,{children:[U," Spend Overview"]}),(0,t.jsxs)(o.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Spend"}),(0,t.jsxs)(h.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,q.formatNumberWithCommas)(j.metadata.total_spend,2)]})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:j.metadata.total_api_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Successful Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:j.metadata.total_successful_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Failed Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:j.metadata.total_failed_requests.toLocaleString()})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Tokens"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:j.metadata.total_tokens.toLocaleString()})]})]})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Daily Spend"}),(0,t.jsx)(l.BarChart,{data:[...j.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:X.valueFormatterSpend,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload,r=Object.keys(a.breakdown.entities||{}).length;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Total Spend: $",(0,q.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Tokens: ",a.metrics.total_tokens]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total ",U,"s: ",r]}),(0,t.jsxs)("div",{className:"mt-2 border-t pt-2",children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Spend by ",U,":"]}),Object.entries(a.breakdown.entities||{}).sort(([,e],[,t])=>{let s=e.metrics.spend;return t.metrics.spend-s}).slice(0,5).map(([e,s])=>(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[M(e,s.metadata),": $",(0,q.formatNumberWithCommas)(s.metrics.spend,2)]},e)),r>5&&(0,t.jsxs)("p",{className:"text-sm text-gray-500 italic",children:["...and ",r-5," more"]})]})]})}})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,t.jsxs)(p.Title,{children:["Spend Per ",U]}),(0,t.jsx)(I.Subtitle,{className:"text-xs",children:"Showing Top 5 by Spend"}),(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,t.jsxs)("span",{children:["Get Started by Tracking cost per ",U," "]}),(0,t.jsx)("a",{href:"https://docs.litellm.ai/docs/proxy/enterprise#spend-tracking",className:"text-blue-500 hover:text-blue-700 ml-1",children:"here"})]})]}),(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-6",children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(l.BarChart,{className:"mt-4 h-52",data:$().slice(0,5).map(e=>({...e,metadata:{...e.metadata,alias_display:e.metadata.alias&&e.metadata.alias.length>15?`${e.metadata.alias.slice(0,15)}...`:e.metadata.alias}})),index:"metadata.alias_display",categories:["metrics.spend"],colors:["cyan"],valueFormatter:X.valueFormatterSpend,layout:"vertical",showLegend:!1,yAxisWidth:150,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.metadata.alias}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,q.formatNumberWithCommas)(a.metrics.spend,4)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.metrics.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.metrics.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens.toLocaleString()]})]})}})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)("div",{className:"h-52 overflow-y-auto",children:(0,t.jsxs)(W.Table,{children:[(0,t.jsx)(B.TableHead,{children:(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(H.TableHeaderCell,{children:U}),(0,t.jsx)(H.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(H.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(K.TableBody,{children:$().filter(e=>e.metrics.spend>0).map(e=>(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(G.TableCell,{children:e.metadata.alias}),(0,t.jsxs)(G.TableCell,{children:["$",(0,q.formatNumberWithCommas)(e.metrics.spend,4)]}),(0,t.jsx)(G.TableCell,{className:"text-green-600",children:e.metrics.successful_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{className:"text-red-600",children:e.metrics.failed_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{children:e.metrics.total_tokens.toLocaleString()})]},e.metadata.id))})]})})})]})]})})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(eS.default,{topKeys:(console.log("debugTags",{spendData:j}),g={},j.results.forEach(e=>{let{breakdown:t}=e,{entities:s}=t;console.log("debugTags",{entities:s});let a=Object.keys(s).reduce((e,t)=>{let{api_key_breakdown:a}=s[t];return Object.keys(a).forEach(s=>{let r={tag:t,usage:a[s].metrics.spend};e[s]?e[s].push(r):e[s]=[r]}),e},{});console.log("debugTags",{tagDictionary:a}),Object.entries(e.breakdown.api_keys||{}).forEach(([e,t])=>{g[e]||(g[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:t.metadata.key_alias,team_id:t.metadata.team_id||null,tags:a[e]||[]}},console.log("debugTags",{keySpend:g})),g[e].metrics.spend+=t.metrics.spend,g[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,g[e].metrics.completion_tokens+=t.metrics.completion_tokens,g[e].metrics.total_tokens+=t.metrics.total_tokens,g[e].metrics.api_requests+=t.metrics.api_requests,g[e].metrics.successful_requests+=t.metrics.successful_requests,g[e].metrics.failed_requests+=t.metrics.failed_requests,g[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,g[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries(g).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||"-",spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,w)),teams:null,showTags:"tag"===s,topKeysLimit:w,setTopKeysLimit:S})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"agent"===s?"Top Agents":"Top Models"}),(0,t.jsx)(eD,{topModels:(_={},j.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,t])=>{_[e]||(_[e]={spend:0,requests:0,successful_requests:0,failed_requests:0,tokens:0});try{_[e].spend+=t.metrics.spend}catch(s){console.error(`Error adding spend for ${e}: ${s}, got metrics: ${JSON.stringify(t)}`)}_[e].requests+=t.metrics.api_requests,_[e].successful_requests+=t.metrics.successful_requests,_[e].failed_requests+=t.metrics.failed_requests,_[e].tokens+=t.metrics.total_tokens})}),Object.entries(_).map(([e,t])=>({key:e,...t})).sort((e,t)=>t.spend-e.spend).slice(0,L)),topModelsLimit:L,setTopModelsLimit:A})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(i.Card,{children:(0,t.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,t.jsx)(p.Title,{children:"Provider Usage"}),(0,t.jsxs)(o.Grid,{numItems:2,children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(eC.DonutChart,{className:"mt-4 h-40",data:O(),index:"provider",category:"spend",valueFormatter:e=>`$${(0,q.formatNumberWithCommas)(e,2)}`,colors:["cyan","blue","indigo","violet","purple"]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(W.Table,{children:[(0,t.jsx)(B.TableHead,{children:(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(H.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(H.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(H.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(K.TableBody,{children:O().map(e=>(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(G.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)("img",{src:(0,eq.getProviderLogoAndName)(e.provider).logo,alt:`${e.provider} logo`,className:"w-4 h-4",onError:t=>{let s=t.target,a=s.parentElement;if(a){let t=document.createElement("div");t.className="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-xs",t.textContent=e.provider?.charAt(0)||"-",a.replaceChild(t,s)}}}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(G.TableCell,{children:["$",(0,q.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(G.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})})})]})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(D.ActivityMetrics,{modelMetrics:v,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(D.ActivityMetrics,{modelMetrics:T,hidePromptCachingMetrics:"agent"===s})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(eT,{userSpendData:j})})]})]})]})};var eE=e.i(793130),eF=e.i(418371);let eO=({loading:e,isDateChanging:a,providerSpend:r})=>{let[l,c]=(0,k.useState)(!1),[d,u]=(0,k.useState)(!1),m=r.filter(e=>e.provider?.toLowerCase()==="unknown"?d:!!l||e.spend>0);return(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(p.Title,{children:"Spend by Provider"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Zero Spend"}),(0,t.jsx)(eE.Switch,{checked:l,onChange:c})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("label",{className:"text-sm text-gray-700",children:"Show Unknown"}),(0,t.jsx)(j.Tooltip,{title:"Requests that failed to route to a provider",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(eE.Switch,{checked:d,onChange:u})]})]})]}),e?(0,t.jsx)($,{isDateChanging:a}):(0,t.jsxs)(o.Grid,{numItems:2,children:[(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsx)(eC.DonutChart,{className:"mt-4 h-40",data:m,index:"provider",category:"spend",valueFormatter:e=>`$${(0,q.formatNumberWithCommas)(e,2)}`,colors:["cyan"]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(W.Table,{children:[(0,t.jsx)(B.TableHead,{children:(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(H.TableHeaderCell,{children:"Provider"}),(0,t.jsx)(H.TableHeaderCell,{children:"Spend"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-green-600",children:"Successful"}),(0,t.jsx)(H.TableHeaderCell,{className:"text-red-600",children:"Failed"}),(0,t.jsx)(H.TableHeaderCell,{children:"Tokens"})]})}),(0,t.jsx)(K.TableBody,{children:m.map(e=>(0,t.jsxs)(Y.TableRow,{children:[(0,t.jsx)(G.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[e.provider&&(0,t.jsx)(eF.ProviderLogo,{provider:e.provider,className:"w-4 h-4"}),(0,t.jsx)("span",{children:e.provider})]})}),(0,t.jsxs)(G.TableCell,{children:["$",(0,q.formatNumberWithCommas)(e.spend,2)]}),(0,t.jsx)(G.TableCell,{className:"text-green-600",children:e.successful_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{className:"text-red-600",children:e.failed_requests.toLocaleString()}),(0,t.jsx)(G.TableCell,{children:e.tokens.toLocaleString()})]},e.provider))})]})})]})]})};var eM=e.i(299251),e$=e.i(153702);e.i(247167);var eU=e.i(931067);let eV={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.4 800.9c.2-.3.5-.6.7-.9C920.6 722.1 960 621.7 960 512s-39.4-210.1-104.8-288c-.2-.3-.5-.5-.7-.8-1.1-1.3-2.1-2.5-3.2-3.7-.4-.5-.8-.9-1.2-1.4l-4.1-4.7-.1-.1c-1.5-1.7-3.1-3.4-4.6-5.1l-.1-.1c-3.2-3.4-6.4-6.8-9.7-10.1l-.1-.1-4.8-4.8-.3-.3c-1.5-1.5-3-2.9-4.5-4.3-.5-.5-1-1-1.6-1.5-1-1-2-1.9-3-2.8-.3-.3-.7-.6-1-1C736.4 109.2 629.5 64 512 64s-224.4 45.2-304.3 119.2c-.3.3-.7.6-1 1-1 .9-2 1.9-3 2.9-.5.5-1 1-1.6 1.5-1.5 1.4-3 2.9-4.5 4.3l-.3.3-4.8 4.8-.1.1c-3.3 3.3-6.5 6.7-9.7 10.1l-.1.1c-1.6 1.7-3.1 3.4-4.6 5.1l-.1.1c-1.4 1.5-2.8 3.1-4.1 4.7-.4.5-.8.9-1.2 1.4-1.1 1.2-2.1 2.5-3.2 3.7-.2.3-.5.5-.7.8C103.4 301.9 64 402.3 64 512s39.4 210.1 104.8 288c.2.3.5.6.7.9l3.1 3.7c.4.5.8.9 1.2 1.4l4.1 4.7c0 .1.1.1.1.2 1.5 1.7 3 3.4 4.6 5l.1.1c3.2 3.4 6.4 6.8 9.6 10.1l.1.1c1.6 1.6 3.1 3.2 4.7 4.7l.3.3c3.3 3.3 6.7 6.5 10.1 9.6 80.1 74 187 119.2 304.5 119.2s224.4-45.2 304.3-119.2a300 300 0 0010-9.6l.3-.3c1.6-1.6 3.2-3.1 4.7-4.7l.1-.1c3.3-3.3 6.5-6.7 9.6-10.1l.1-.1c1.5-1.7 3.1-3.3 4.6-5 0-.1.1-.1.1-.2 1.4-1.5 2.8-3.1 4.1-4.7.4-.5.8-.9 1.2-1.4a99 99 0 003.3-3.7zm4.1-142.6c-13.8 32.6-32 62.8-54.2 90.2a444.07 444.07 0 00-81.5-55.9c11.6-46.9 18.8-98.4 20.7-152.6H887c-3 40.9-12.6 80.6-28.5 118.3zM887 484H743.5c-1.9-54.2-9.1-105.7-20.7-152.6 29.3-15.6 56.6-34.4 81.5-55.9A373.86 373.86 0 01887 484zM658.3 165.5c39.7 16.8 75.8 40 107.6 69.2a394.72 394.72 0 01-59.4 41.8c-15.7-45-35.8-84.1-59.2-115.4 3.7 1.4 7.4 2.9 11 4.4zm-90.6 700.6c-9.2 7.2-18.4 12.7-27.7 16.4V697a389.1 389.1 0 01115.7 26.2c-8.3 24.6-17.9 47.3-29 67.8-17.4 32.4-37.8 58.3-59 75.1zm59-633.1c11 20.6 20.7 43.3 29 67.8A389.1 389.1 0 01540 327V141.6c9.2 3.7 18.5 9.1 27.7 16.4 21.2 16.7 41.6 42.6 59 75zM540 640.9V540h147.5c-1.6 44.2-7.1 87.1-16.3 127.8l-.3 1.2A445.02 445.02 0 00540 640.9zm0-156.9V383.1c45.8-2.8 89.8-12.5 130.9-28.1l.3 1.2c9.2 40.7 14.7 83.5 16.3 127.8H540zm-56 56v100.9c-45.8 2.8-89.8 12.5-130.9 28.1l-.3-1.2c-9.2-40.7-14.7-83.5-16.3-127.8H484zm-147.5-56c1.6-44.2 7.1-87.1 16.3-127.8l.3-1.2c41.1 15.6 85 25.3 130.9 28.1V484H336.5zM484 697v185.4c-9.2-3.7-18.5-9.1-27.7-16.4-21.2-16.7-41.7-42.7-59.1-75.1-11-20.6-20.7-43.3-29-67.8 37.2-14.6 75.9-23.3 115.8-26.1zm0-370a389.1 389.1 0 01-115.7-26.2c8.3-24.6 17.9-47.3 29-67.8 17.4-32.4 37.8-58.4 59.1-75.1 9.2-7.2 18.4-12.7 27.7-16.4V327zM365.7 165.5c3.7-1.5 7.3-3 11-4.4-23.4 31.3-43.5 70.4-59.2 115.4-21-12-40.9-26-59.4-41.8 31.8-29.2 67.9-52.4 107.6-69.2zM165.5 365.7c13.8-32.6 32-62.8 54.2-90.2 24.9 21.5 52.2 40.3 81.5 55.9-11.6 46.9-18.8 98.4-20.7 152.6H137c3-40.9 12.6-80.6 28.5-118.3zM137 540h143.5c1.9 54.2 9.1 105.7 20.7 152.6a444.07 444.07 0 00-81.5 55.9A373.86 373.86 0 01137 540zm228.7 318.5c-39.7-16.8-75.8-40-107.6-69.2 18.5-15.8 38.4-29.7 59.4-41.8 15.7 45 35.8 84.1 59.2 115.4-3.7-1.4-7.4-2.9-11-4.4zm292.6 0c-3.7 1.5-7.3 3-11 4.4 23.4-31.3 43.5-70.4 59.2-115.4 21 12 40.9 26 59.4 41.8a373.81 373.81 0 01-107.6 69.2z"}}]},name:"global",theme:"outlined"};var eR=e.i(9583),ez=k.forwardRef(function(e,t){return k.createElement(eR.default,(0,eU.default)({},e,{ref:t,icon:eV}))}),eP=e.i(777579),eI=e.i(983561);let eW={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"};var eB=k.forwardRef(function(e,t){return k.createElement(eR.default,(0,eU.default)({},e,{ref:t,icon:eW}))}),eY=e.i(232164),eH=e.i(645526),eK=e.i(906579);let eG=[{value:"global",label:"Global Usage",showForAdmin:"Global Usage",showForNonAdmin:"Your Usage",description:"View usage across all resources",descriptionForAdmin:"View usage across all resources",descriptionForNonAdmin:"View your usage",icon:(0,t.jsx)(ez,{style:{fontSize:"16px"}})},{value:"organization",label:"Organization Usage",showForAdmin:"Organization Usage",showForNonAdmin:"Your Organization Usage",description:"View organization-level usage",descriptionForAdmin:"View usage across all organizations",descriptionForNonAdmin:"View your organization's usage",icon:(0,t.jsx)(eM.BankOutlined,{style:{fontSize:"16px"}})},{value:"team",label:"Team Usage",description:"View usage by team",icon:(0,t.jsx)(eH.TeamOutlined,{style:{fontSize:"16px"}})},{value:"customer",label:"Customer Usage",description:"View usage by customer accounts",icon:(0,t.jsx)(eB,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"tag",label:"Tag Usage",description:"View usage grouped by tags",icon:(0,t.jsx)(eY.TagsOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"agent",label:"Agent Usage (A2A)",description:"View usage by AI agents",icon:(0,t.jsx)(eI.RobotOutlined,{style:{fontSize:"16px"}}),adminOnly:!0},{value:"user-agent-activity",label:"User Agent Activity",description:"View detailed user agent activity logs",icon:(0,t.jsx)(eP.LineChartOutlined,{style:{fontSize:"16px"}}),adminOnly:!0}],eZ=({value:e,onChange:s,isAdmin:a,title:r="Usage View",description:l="Select the usage data you want to view","data-id":i})=>{let n=eG.filter(e=>!e.adminOnly||!!a).map(e=>{let t=e.label,s=e.description;return e.showForAdmin&&e.showForNonAdmin&&(t=a?e.showForAdmin:e.showForNonAdmin),e.descriptionForAdmin&&e.descriptionForNonAdmin&&(s=a?e.descriptionForAdmin:e.descriptionForNonAdmin),{value:e.value,label:t,description:s,icon:e.icon,badgeText:e.badgeText}});return(0,t.jsx)("div",{className:"w-full","data-id":i,children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-start gap-4",children:[(0,t.jsxs)("div",{className:"flex items-stretch gap-2 min-w-0",children:[(0,t.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,t.jsx)(e$.BarChartOutlined,{style:{fontSize:"32px"}})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-0.5 leading-tight",children:r}),(0,t.jsx)("p",{className:"text-xs text-gray-600 leading-tight",children:l})]})]}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(_.Select,{value:e,onChange:s,className:"w-54 sm:w-64 md:w-72",size:"large",options:n.map(e=>({value:e.value,label:e.label})),optionRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-1",children:[(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:s.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.label}),(0,t.jsx)("div",{className:"text-xs text-gray-600 mt-0.5",children:s.description})]}),s.badgeText&&(0,t.jsx)("div",{className:"items-center",children:(0,t.jsx)(eK.Badge,{color:"blue",count:s.badgeText})})]}):e.label},labelRender:e=>{let s=n.find(t=>t.value===e.value);return s?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{children:s.icon}),(0,t.jsx)("span",{className:"text-sm",children:s.label})]}):e.label}})})]})})};e.s(["default",0,({teams:e,organizations:M})=>{let U,V,{accessToken:R,userRole:z,userId:P,premiumUser:I}=(0,N.default)(),[W,B]=(0,k.useState)({results:[],metadata:{}}),[Y,H]=(0,k.useState)(!1),[K,G]=(0,k.useState)(!1),Z=(0,k.useMemo)(()=>new Date(Date.now()-6048e5),[]),ee=(0,k.useMemo)(()=>new Date,[]),[et,es]=(0,k.useState)({from:Z,to:ee}),[ea,er]=(0,k.useState)([]),{data:el=[]}=(0,T.useCustomers)(),{data:ei}=(0,v.useAgents)(),{data:en}=(0,C.useCurrentUser)();console.log(`currentUser: ${JSON.stringify(en)}`),console.log(`currentUser max budget: ${en?.max_budget}`);let eo=L.all_admin_roles.includes(z||""),[ec,ed]=(0,k.useState)(""),[eu,em]=(0,b.useDebouncedState)("",{wait:300}),{data:ex,fetchNextPage:eh,hasNextPage:ep,isFetchingNextPage:ef,isLoading:eg}=(0,w.useInfiniteUsers)(50,eu||void 0),e_=(0,k.useMemo)(()=>{if(!ex?.pages)return[];let e=new Set,t=[];for(let s of ex.pages)for(let a of s.users)e.has(a.user_id)||(e.add(a.user_id),t.push({value:a.user_id,label:a.user_alias?`${a.user_alias} (${a.user_id})`:a.user_email?`${a.user_email} (${a.user_id})`:a.user_id}));return t},[ex]),[ej,ey]=(0,k.useState)(eo?null:P||null),[eb,ek]=(0,k.useState)("groups"),[ev,eN]=(0,k.useState)(!1),[eC,ew]=(0,k.useState)(!1),[eq,eL]=(0,k.useState)("global"),[eD,eE]=(0,k.useState)(!0),[eF,eM]=(0,k.useState)(5),[e$,eU]=(0,k.useState)(5),eV=async()=>{R&&er(Object.values(await (0,F.tagListCall)(R)).map(e=>({label:e.name,value:e.name})))};(0,k.useEffect)(()=>{eV()},[R]),(0,k.useEffect)(()=>{!eo&&P&&ey(P)},[eo,P]);let eR=W.metadata?.total_spend||0,ez=(0,k.useCallback)(async()=>{if(!R||!et.from||!et.to)return;let e=eo?ej:P||null;H(!0);let t=new Date(et.from),s=new Date(et.to);try{try{let a=await (0,F.userDailyActivityAggregatedCall)(R,t,s,e);B(a);return}catch(e){}let a=await (0,F.userDailyActivityCall)(R,t,s,1,e);if(a.metadata.total_pages<=1)return void B(a);let r=[...a.results],l={...a.metadata};for(let i=2;i<=a.metadata.total_pages;i++){let a=await (0,F.userDailyActivityCall)(R,t,s,i,e);r.push(...a.results),a.metadata&&(l.total_spend+=a.metadata.total_spend||0,l.total_api_requests+=a.metadata.total_api_requests||0,l.total_successful_requests+=a.metadata.total_successful_requests||0,l.total_failed_requests+=a.metadata.total_failed_requests||0,l.total_tokens+=a.metadata.total_tokens||0)}B({results:r,metadata:l})}catch(e){console.error("Error fetching user spend data:",e)}finally{H(!1),G(!1)}},[R,et.from,et.to,ej,eo,P]),eP=(0,k.useCallback)(e=>{G(!0),H(!0),es(e)},[]);(0,k.useEffect)(()=>{if(!et.from||!et.to)return;let e=setTimeout(()=>{ez()},50);return()=>clearTimeout(e)},[ez]);let eI=(0,D.processActivityData)(W,"models",e),eW=(0,D.processActivityData)(W,"api_keys",e),eB=(0,D.processActivityData)(W,"mcp_servers",e);return(0,t.jsxs)("div",{style:{width:"100%"},className:"p-8 relative",children:[(0,t.jsx)("div",{className:"flex items-end justify-between gap-6 mb-6",children:(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-end justify-between gap-6 mb-4 w-full",children:[(0,t.jsx)(eZ,{value:eq,onChange:e=>eL(e),isAdmin:eo}),(0,t.jsx)(O.default,{value:et,onValueChange:eP})]}),"global"===eq&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(d.TabGroup,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(u.TabList,{variant:"solid",className:"mt-1",children:[(0,t.jsx)(c.Tab,{children:"Cost"}),(0,t.jsx)(c.Tab,{children:"Model Activity"}),(0,t.jsx)(c.Tab,{children:"Key Activity"}),(0,t.jsx)(c.Tab,{children:"MCP Server Activity"}),(0,t.jsx)(c.Tab,{children:"Endpoint Activity"})]}),(0,t.jsx)(S.Button,{onClick:()=>ew(!0),icon:()=>(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),children:"Export Data"})]}),(0,t.jsxs)(x.TabPanels,{children:[(0,t.jsx)(m.TabPanel,{children:(0,t.jsxs)(o.Grid,{numItems:2,className:"gap-2 w-full",children:[(0,t.jsxs)(n.Col,{numColSpan:2,children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mt-2 mb-2",children:[(0,t.jsxs)(h.Text,{className:"text-tremor-default text-tremor-content dark:text-dark-tremor-content text-lg",children:["Project Spend"," ",et.from&&et.to&&(0,t.jsxs)(t.Fragment,{children:[et.from.toLocaleDateString("en-US",{month:"short",day:"numeric",year:et.from.getFullYear()!==et.to.getFullYear()?"numeric":void 0})," - ",et.to.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]})]}),eo&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.UserOutlined,{style:{fontSize:"14px",color:"#6b7280"}}),(0,t.jsx)(_.Select,{showSearch:!0,allowClear:!0,style:{width:300},placeholder:"All Users (Global View)",value:ej,onChange:e=>ey(e??null),filterOption:!1,onSearch:e=>{ed(e),em(e)},searchValue:ec,onPopupScroll:e=>{let t=e.currentTarget;(t.scrollTop+t.clientHeight)/t.scrollHeight>=.8&&ep&&!ef&&eh()},loading:eg,notFoundContent:eg?(0,t.jsx)(a.LoadingOutlined,{spin:!0}):"No users found",options:e_,popupRender:e=>(0,t.jsxs)(t.Fragment,{children:[e,ef&&(0,t.jsx)("div",{style:{textAlign:"center",padding:8},children:(0,t.jsx)(a.LoadingOutlined,{spin:!0})})]})}),ej&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Filtering by user"})]})]}),(0,t.jsx)(Q.default,{userSpend:eR,selectedTeam:null,userMaxBudget:en?.max_budget||null})]}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Usage Metrics"}),(0,t.jsxs)(o.Grid,{numItems:5,className:"gap-4 mt-4",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:W.metadata?.total_api_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Successful Requests"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-green-600",children:W.metadata?.total_successful_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Title,{children:"Failed Requests"}),(0,t.jsx)(j.Tooltip,{title:"Includes requests that failed to route to a provider, tool usage failures, and other request errors where the provider cannot be determined.",children:(0,t.jsx)(s.InfoCircleOutlined,{className:"text-gray-400 hover:text-gray-600"})})]}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2 text-red-600",children:W.metadata?.total_failed_requests?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Total Tokens"}),(0,t.jsx)(h.Text,{className:"text-2xl font-bold mt-2",children:W.metadata?.total_tokens?.toLocaleString()||0})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Average Cost per Request"}),(0,t.jsxs)(h.Text,{className:"text-2xl font-bold mt-2",children:["$",(0,q.formatNumberWithCommas)((eR||0)/(W.metadata?.total_api_requests||1),4)]})]})]})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(p.Title,{children:"Daily Spend"}),Y?(0,t.jsx)($,{isDateChanging:K}):(0,t.jsx)(l.BarChart,{data:[...W.results].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),index:"date",categories:["metrics.spend"],colors:["cyan"],valueFormatter:X.valueFormatterSpend,yAxisWidth:100,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.date}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,q.formatNumberWithCommas)(a.metrics.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Requests: ",a.metrics.api_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Successful: ",a.metrics.successful_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Failed: ",a.metrics.failed_requests]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.metrics.total_tokens]})]})}})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsx)(p.Title,{children:"Top Virtual Keys"}),(0,t.jsx)(eS.default,{topKeys:((e=5)=>{let t={};return W.results.forEach(e=>{Object.entries(e.breakdown.api_keys||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{key_alias:s.metadata.key_alias,team_id:null,tags:s.metadata.tags||[]}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests,t[e].metrics.failed_requests+=s.metrics.failed_requests,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),console.log("debugTags",{keySpend:t,userSpendData:W}),Object.entries(t).map(([e,t])=>({api_key:e,key_alias:t.metadata.key_alias||"-",tags:t.metadata.tags||[],spend:t.metrics.spend})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(eF),teams:null,topKeysLimit:eF,setTopKeysLimit:eM})]})}),(0,t.jsx)(n.Col,{numColSpan:1,children:(0,t.jsxs)(i.Card,{className:"h-full",children:[(0,t.jsx)(p.Title,{children:"groups"===eb?"Top Public Model Names":"Top Litellm Models"}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)(g.Segmented,{options:[{label:"5",value:5},{label:"10",value:10},{label:"25",value:25},{label:"50",value:50}],value:e$,onChange:e=>eU(e)}),(0,t.jsxs)("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"groups"===eb?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ek("groups"),children:"Public Model Name"}),(0,t.jsx)("button",{className:`px-3 py-1 text-sm rounded-md transition-colors ${"individual"===eb?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,onClick:()=>ek("individual"),children:"Litellm Model Name"})]})]}),Y?(0,t.jsx)($,{isDateChanging:K}):(0,t.jsx)("div",{className:"relative max-h-[600px] overflow-y-auto",children:(U="groups"===eb?((e=5)=>{let t={};return W.results.forEach(e=>{Object.entries(e.breakdown.model_groups||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(e$):((e=5)=>{let t={};return W.results.forEach(e=>{Object.entries(e.breakdown.models||{}).forEach(([e,s])=>{t[e]||(t[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),t[e].metrics.spend+=s.metrics.spend,t[e].metrics.prompt_tokens+=s.metrics.prompt_tokens,t[e].metrics.completion_tokens+=s.metrics.completion_tokens,t[e].metrics.total_tokens+=s.metrics.total_tokens,t[e].metrics.api_requests+=s.metrics.api_requests,t[e].metrics.successful_requests+=s.metrics.successful_requests||0,t[e].metrics.failed_requests+=s.metrics.failed_requests||0,t[e].metrics.cache_read_input_tokens+=s.metrics.cache_read_input_tokens||0,t[e].metrics.cache_creation_input_tokens+=s.metrics.cache_creation_input_tokens||0})}),Object.entries(t).map(([e,t])=>({key:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})).sort((e,t)=>t.spend-e.spend).slice(0,e)})(e$),(0,t.jsx)(l.BarChart,{className:"mt-4",style:{height:52*Math.min(U.length,e$)},data:U,index:"key",categories:["spend"],colors:["cyan"],valueFormatter:X.valueFormatterSpend,layout:"vertical",yAxisWidth:200,showLegend:!1,customTooltip:({payload:e,active:s})=>{if(!s||!e?.[0])return null;let a=e[0].payload;return(0,t.jsxs)("div",{className:"bg-white p-4 shadow-lg rounded-lg border",children:[(0,t.jsx)("p",{className:"font-bold",children:a.key}),(0,t.jsxs)("p",{className:"text-cyan-500",children:["Spend: $",(0,q.formatNumberWithCommas)(a.spend,2)]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Total Requests: ",a.requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-green-600",children:["Successful: ",a.successful_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-red-600",children:["Failed: ",a.failed_requests.toLocaleString()]}),(0,t.jsxs)("p",{className:"text-gray-600",children:["Tokens: ",a.tokens.toLocaleString()]})]})}}))})]})}),(0,t.jsx)(n.Col,{numColSpan:2,children:(0,t.jsx)(eO,{loading:Y,isDateChanging:K,providerSpend:(V={},W.results.forEach(e=>{Object.entries(e.breakdown.providers||{}).forEach(([e,t])=>{V[e]||(V[e]={metrics:{spend:0,prompt_tokens:0,completion_tokens:0,total_tokens:0,api_requests:0,successful_requests:0,failed_requests:0,cache_read_input_tokens:0,cache_creation_input_tokens:0},metadata:{},api_key_breakdown:{}}),V[e].metrics.spend+=t.metrics.spend,V[e].metrics.prompt_tokens+=t.metrics.prompt_tokens,V[e].metrics.completion_tokens+=t.metrics.completion_tokens,V[e].metrics.total_tokens+=t.metrics.total_tokens,V[e].metrics.api_requests+=t.metrics.api_requests,V[e].metrics.successful_requests+=t.metrics.successful_requests||0,V[e].metrics.failed_requests+=t.metrics.failed_requests||0,V[e].metrics.cache_read_input_tokens+=t.metrics.cache_read_input_tokens||0,V[e].metrics.cache_creation_input_tokens+=t.metrics.cache_creation_input_tokens||0})}),Object.entries(V).map(([e,t])=>({provider:e,spend:t.metrics.spend,requests:t.metrics.api_requests,successful_requests:t.metrics.successful_requests,failed_requests:t.metrics.failed_requests,tokens:t.metrics.total_tokens})))})})]})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(D.ActivityMetrics,{modelMetrics:eI})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(D.ActivityMetrics,{modelMetrics:eW})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(D.ActivityMetrics,{modelMetrics:eB})}),(0,t.jsx)(m.TabPanel,{children:(0,t.jsx)(eT,{userSpendData:W})})]})]})}),"organization"===eq&&(0,t.jsx)(eA,{accessToken:R,entityType:"organization",userID:P,userRole:z,dateValue:et,entityList:M?.map(e=>({label:e.organization_alias,value:e.organization_id}))||null,premiumUser:I}),"team"===eq&&(0,t.jsx)(eA,{accessToken:R,entityType:"team",userID:P,userRole:z,entityList:e?.map(e=>({label:e.team_alias,value:e.team_id}))||null,premiumUser:I,dateValue:et}),"customer"===eq&&(0,t.jsx)(eA,{accessToken:R,entityType:"customer",userID:P,userRole:z,entityList:el?.map(e=>({label:e.alias||e.user_id,value:e.user_id}))||null,premiumUser:I,dateValue:et}),"tag"===eq&&(0,t.jsxs)(t.Fragment,{children:[eD&&(0,t.jsx)(f.Alert,{banner:!0,type:"info",message:"Reusable credentials are automatically tracked as tags",description:(0,t.jsxs)(y.Typography.Text,{children:["When a reusable credential is used, it will appear as a tag prefixed with"," ",(0,t.jsx)(y.Typography.Text,{code:!0,children:"Credential: "}),"in this view."]}),closable:!0,onClose:()=>eE(!1),className:"mb-5"}),(0,t.jsx)(eA,{accessToken:R,entityType:"tag",userID:P,userRole:z,entityList:ea,premiumUser:I,dateValue:et})]}),"agent"===eq&&(0,t.jsx)(eA,{accessToken:R,entityType:"agent",userID:P,userRole:z,entityList:ei?.agents?.map(e=>({label:e.agent_name,value:e.agent_id}))||null,premiumUser:I,dateValue:et}),"user-agent-activity"===eq&&(0,t.jsx)(J,{accessToken:R,userRole:z,dateValue:et})]})}),(0,t.jsx)(A.default,{isOpen:ev,onClose:()=>eN(!1),accessToken:R}),(0,t.jsx)(E.default,{isOpen:eC,onClose:()=>ew(!1),entityType:"team",spendData:{results:W.results,metadata:W.metadata},dateRange:et,selectedFilters:[],customTitle:"Export Usage Data"})]})}],797305)}]);